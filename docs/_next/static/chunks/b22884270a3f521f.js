(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81694,e=>{"use strict";let t,n,i,r,s,o,a,l,h,c,u,d,p,f;var m,_,g,y,v,w=e.i(43476),C=e.i(71645);function b(e,t,n,i){for(let r=0;r<9;r++)if(e[t][r]===i||e[r][n]===i)return!1;let r=3*Math.floor(t/3),s=3*Math.floor(n/3);for(let t=0;t<3;t++)for(let n=0;n<3;n++)if(e[r+t][s+n]===i)return!1;return!0}function I(e,t,n,i){if(0===i)return!1;for(let r=0;r<9;r++)if(r!==n&&e[t][r]===i||r!==t&&e[r][n]===i)return!0;let r=3*Math.floor(t/3),s=3*Math.floor(n/3);for(let o=0;o<3;o++)for(let a=0;a<3;a++){let l=r+o,h=s+a;if((l!==t||h!==n)&&e[l][h]===i)return!0}return!1}function T(e){let t=new(window.AudioContext||window.webkitAudioContext),n=t.createOscillator(),i=t.createGain();switch(n.connect(i),i.connect(t.destination),e){case"place":n.frequency.value=440,i.gain.value=.1,n.start(),n.stop(t.currentTime+.1);break;case"error":n.frequency.value=200,i.gain.value=.15,n.start(),n.stop(t.currentTime+.2);break;case"complete":n.frequency.value=523,i.gain.value=.2,n.start(),n.stop(t.currentTime+.3),setTimeout(()=>{let e=t.createOscillator(),n=t.createGain();e.connect(n),n.connect(t.destination),e.frequency.value=659,n.gain.value=.2,e.start(),e.stop(t.currentTime+.3)},150);break;case"hint":n.frequency.value=880,i.gain.value=.15,n.start(),n.stop(t.currentTime+.15)}}let E=(0,e.i(68834).create)((e,t)=>({puzzle:null,solution:null,board:null,initialBoard:null,difficulty:"medium",selectedCell:null,selectedNumber:null,mode:"normal",candidates:{},history:[],historyIndex:-1,timer:0,timerRunning:!1,errors:0,hintsUsed:0,gameStarted:!1,gameCompleted:!1,solvedManually:!0,hintCell:null,settings:{timerEnabled:!0,errorCounterEnabled:!0,checkOnEntry:!0,highlightRow:!0,highlightColumn:!0,highlightBox:!0,highlightIdentical:!0,soundEnabled:!1},startNewGame:t=>{let{puzzle:n,solution:i}=function(e="medium"){let t,n=(!function e(t){for(let n=0;n<9;n++)for(let i=0;i<9;i++)if(0===t[n][i]){for(let r of function(e){let t=[...e];for(let e=t.length-1;e>0;e--){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}([1,2,3,4,5,6,7,8,9]))if(b(t,n,i,r)){if(t[n][i]=r,e(t))return!0;t[n][i]=0}return!1}return!0}(t=Array(9).fill(null).map(()=>Array(9).fill(0))),t);return{puzzle:function(e,t){let n=e.map(e=>[...e]),i=0,r=3*t;for(let e=0;e<r&&i<t;e++){let e=Math.floor(9*Math.random()),t=Math.floor(9*Math.random());if(0!==n[e][t]){let r=n[e][t];n[e][t]=0,1===function(e,t=2){let n=0;return!function e(i){if(!(n>=t)){for(let t=0;t<9;t++)for(let n=0;n<9;n++)if(0===i[t][n]){for(let r=1;r<=9;r++)b(i,t,n,r)&&(i[t][n]=r,e(i),i[t][n]=0);return}n++}}(e.map(e=>[...e])),n}(n)?i++:n[e][t]=r}}return n}(n,{easy:35,medium:45,hard:55}[e]||45),solution:n}}(t),r=n.map(e=>[...e]);e({puzzle:n,solution:i,board:r,initialBoard:n.map(e=>[...e]),difficulty:t,selectedCell:null,selectedNumber:null,candidates:{},history:[],historyIndex:-1,timer:0,timerRunning:!0,errors:0,hintsUsed:0,gameStarted:!0,gameCompleted:!1})},selectCell:(n,i)=>{let{board:r}=t();r&&e({selectedCell:{row:n,col:i}})},selectNumber:t=>{e({selectedNumber:t})},setMode:t=>{e({mode:t})},placeNumber:(n,i,r)=>{let{board:s,initialBoard:o,mode:a,candidates:l,settings:h,errors:c}=t();if(0!==o[n][i])return;let u=s.map(e=>[...e]),d={...l},p=`${n}-${i}`;if("normal"===a){let s=u[n][i];u[n][i]=r,0!==r&&h.checkOnEntry&&I(u,n,i,r)?(e({errors:c+1,timer:t().timer+30}),h.soundEnabled&&T("error")):0!==r&&h.soundEnabled&&T("place"),delete d[p],t().addToHistory({type:"place",row:n,col:i,oldValue:s,newValue:r})}else{d[p]||(d[p]=[]);let e=[...d[p]],s=e.indexOf(r);s>-1?e.splice(s,1):(e.push(r),e.sort()),d[p]=e,t().addToHistory({type:"candidate",row:n,col:i,oldValue:l[p]||[],newValue:e})}e({board:u,candidates:d}),function(e){for(let t=0;t<9;t++)for(let n=0;n<9;n++)if(0===e[t][n])return!1;return!0}(u)&&function(e){for(let t=0;t<9;t++)for(let n=0;n<9;n++){let i=e[t][n];if(0!==i&&I(e,t,n,i))return!1}return!0}(u)&&(e({gameCompleted:!0,timerRunning:!1,solvedManually:!0}),h.soundEnabled&&T("complete"))},clearCell:(n,i)=>{let{board:r,initialBoard:s,candidates:o}=t();if(0!==s[n][i])return;let a=r.map(e=>[...e]),l={...o},h=`${n}-${i}`,c=a[n][i];a[n][i]=0,delete l[h],t().addToHistory({type:"clear",row:n,col:i,oldValue:c}),e({board:a,candidates:l})},useHint:()=>{let{board:n,solution:i,hintsUsed:r}=t(),s=function(e,t){let n=[];for(let t=0;t<9;t++)for(let i=0;i<9;i++)0===e[t][i]&&n.push({row:t,col:i});if(0===n.length)return null;let i=n[Math.floor(Math.random()*n.length)];return{row:i.row,col:i.col,value:t[i.row][i.col]}}(n,i);if(s){let{settings:n}=t();n.soundEnabled&&T("hint"),t().placeNumber(s.row,s.col,s.value),e({hintsUsed:r+1,hintCell:{row:s.row,col:s.col}}),setTimeout(()=>{e({hintCell:null})},2e3)}},autoFillCandidates:()=>{let{board:n}=t();e({candidates:function(e){let t={};for(let n=0;n<9;n++)for(let i=0;i<9;i++)0===e[n][i]&&(t[`${n}-${i}`]=function(e,t,n){if(0!==e[t][n])return[];let i=new Set([1,2,3,4,5,6,7,8,9]);for(let r=0;r<9;r++)i.delete(e[t][r]),i.delete(e[r][n]);let r=3*Math.floor(t/3),s=3*Math.floor(n/3);for(let t=0;t<3;t++)for(let n=0;n<3;n++)i.delete(e[r+t][s+n]);return Array.from(i).sort()}(e,n,i));return t}(n)})},solvePuzzle:()=>{let n,{board:i}=t();e({board:(n=i.map(e=>[...e]),!function e(){for(let t=0;t<9;t++)for(let i=0;i<9;i++)if(0===n[t][i]){for(let r=1;r<=9;r++)if(function(e,t,n,i){for(let r=0;r<9;r++)if(e[t][r]===i||e[r][n]===i)return!1;let r=3*Math.floor(t/3),s=3*Math.floor(n/3);for(let t=0;t<3;t++)for(let n=0;n<3;n++)if(e[r+t][s+n]===i)return!1;return!0}(n,t,i,r)){if(n[t][i]=r,e())return!0;n[t][i]=0}return!1}return!0}(),n),timerRunning:!1,gameCompleted:!0,solvedManually:!1})},addToHistory:n=>{let{history:i,historyIndex:r}=t(),s=i.slice(0,r+1);s.push(n),e({history:s,historyIndex:s.length-1})},undo:()=>{let{history:n,historyIndex:i,board:r,candidates:s}=t();if(i<0)return;let o=n[i],a=r.map(e=>[...e]),l={...s},h=`${o.row}-${o.col}`;"place"===o.type||"clear"===o.type?a[o.row][o.col]=o.oldValue:"candidate"===o.type&&(l[h]=o.oldValue),e({board:a,candidates:l,historyIndex:i-1})},redo:()=>{let{history:n,historyIndex:i,board:r,candidates:s}=t();if(i>=n.length-1)return;let o=n[i+1],a=r.map(e=>[...e]),l={...s},h=`${o.row}-${o.col}`;"place"===o.type?a[o.row][o.col]=o.newValue:"clear"===o.type?a[o.row][o.col]=0:"candidate"===o.type&&(l[h]=o.newValue),e({board:a,candidates:l,historyIndex:i+1})},toggleTimer:()=>{e({timerRunning:!t().timerRunning})},incrementTimer:()=>{let{timerRunning:n}=t();n&&e({timer:t().timer+1})},updateSettings:n=>{e({settings:{...t().settings,...n}})},resetGame:()=>{e({puzzle:null,solution:null,board:null,initialBoard:null,selectedCell:null,selectedNumber:null,candidates:{},history:[],historyIndex:-1,timer:0,timerRunning:!1,errors:0,hintsUsed:0,gameStarted:!1,gameCompleted:!1,solvedManually:!0,hintCell:null})}}));var k=e.i(47167);let S=function(e,t){if(!e)throw N(t)},N=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},P=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},R=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},x={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,c=(3&r)<<4|o>>4,u=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(u=64)),i.push(n[h],n[c],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(P(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):R(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new A;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let O=function(e){let t=P(e);return x.encodeByteArray(t,!0)},D=function(e){return O(e).replace(/\./g,"")},L=function(e){try{return x.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},M=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===k.default||void 0===k.default.env)return;let e=k.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&L(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},j=e=>M()?.emulatorHosts?.[e],F=()=>M()?.config,U=e=>M()?.[`_${e}`];class q{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function W(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function H(e){return(await fetch(e,{credentials:"include"})).ok}let V={},B=!1;function $(e,t){if("undefined"==typeof window||"undefined"==typeof document||!W(window.location.host)||V[e]===t||V[e]||B)return;function n(e){return`__firebase__banner__${e}`}V[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(V))V[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;B=!0,(e=document.getElementById(i))&&e.remove()},e);u.setAttribute("width","24"),u.setAttribute("id",c),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px",t.append(u,a,h,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",u.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(u.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function z(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function K(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(z())}function G(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Y(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function J(){return false}class Q extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Q.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,X.prototype.create)}}class X{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(Z,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Q(s,l,r)}}let Z=/\{\$([^}]+)}/g;function ee(e){return JSON.parse(e)}function et(e){return JSON.stringify(e)}let en=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=ee(L(s[0])||""),n=ee(L(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},ei=function(e){let t=en(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},er=function(e){let t=en(e).claims;return"object"==typeof t&&!0===t.admin};function es(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eo(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function ea(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function el(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eh(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(ec(n)&&ec(s)){if(!eh(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function ec(e){return null!==e&&"object"==typeof e}function eu(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function ed(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ep(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ef{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class em{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=e_),void 0===i.error&&(i.error=e_),void 0===i.complete&&(i.complete=e_);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function e_(){}function eg(e,t){return`${e} failed: ${t} argument `}let ey=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;S(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},ev=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ew(e){return e&&e._delegate?e._delegate:e}class eC{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eb="[DEFAULT]";class eI{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new q;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eb})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eb){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eb){return this.instances.has(e)}getOptions(e=eb){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eb?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=eb){return this.component?this.component.multipleInstances?e:eb:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eT{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eI(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eE=[];(m=y||(y={}))[m.DEBUG=0]="DEBUG",m[m.VERBOSE=1]="VERBOSE",m[m.INFO=2]="INFO",m[m.WARN=3]="WARN",m[m.ERROR=4]="ERROR",m[m.SILENT=5]="SILENT";let ek={debug:y.DEBUG,verbose:y.VERBOSE,info:y.INFO,warn:y.WARN,error:y.ERROR,silent:y.SILENT},eS=y.INFO,eN={[y.DEBUG]:"log",[y.VERBOSE]:"log",[y.INFO]:"info",[y.WARN]:"warn",[y.ERROR]:"error"},eP=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eN[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eR{constructor(e){this.name=e,this._logLevel=eS,this._logHandler=eP,this._userLogHandler=null,eE.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in y))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ek[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,y.DEBUG,...e),this._logHandler(this,y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,y.VERBOSE,...e),this._logHandler(this,y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,y.INFO,...e),this._logHandler(this,y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,y.WARN,...e),this._logHandler(this,y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,y.ERROR,...e),this._logHandler(this,y.ERROR,...e)}}let ex=new WeakMap,eA=new WeakMap,eO=new WeakMap,eD=new WeakMap,eL=new WeakMap,eM={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eA.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eO.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ej(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ej(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ej(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ex.set(t,e)}).catch(()=>{}),eL.set(t,e),t}if(eD.has(e))return eD.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eF(this),t),ej(ex.get(this))}:function(...t){return ej(e.apply(eF(this),t))}:function(t,...n){let i=e.call(eF(this),t,...n);return eO.set(i,t.sort?t.sort():[t]),ej(i)};return e instanceof IDBTransaction&&function(e){if(eA.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eA.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eM):e}(e);return i!==e&&(eD.set(e,i),eL.set(i,e)),i}let eF=e=>eL.get(e),eU=["get","getKey","getAll","getAllKeys","count"],eq=["put","add","delete","clear"],eW=new Map;function eH(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eW.get(t))return eW.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=eq.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||eU.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return eW.set(t,s),s}eM={...f=eM,get:(e,t,n)=>eH(e,t)||f.get(e,t,n),has:(e,t)=>!!eH(e,t)||f.has(e,t)};class eV{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eB="@firebase/app",e$="0.14.6",ez=new eR("@firebase/app"),eK="[DEFAULT]",eG={[eB]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eY=new Map,eJ=new Map,eQ=new Map;function eX(e,t){try{e.container.addComponent(t)}catch(n){ez.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eZ(e,t){e.container.addOrOverwriteComponent(t)}function e0(e){let t=e.name;if(eQ.has(t))return ez.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eQ.set(t,e),eY.values()))eX(n,e);for(let t of eJ.values())eX(t,e);return!0}function e1(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function e3(e,t,n=eK){e1(e,t).clearInstance(n)}function e6(e){return void 0!==e.options}function e2(e){return!e6(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function e4(e){return null!=e&&void 0!==e.settings}function e5(){eQ.clear()}let e8=new X("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e9{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eC("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e8.create("app-deleted",{appName:this._name})}}function e7(e,t){let n=L(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class te extends e9{constructor(e,t,n,i){const r=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&e7(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e7(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,ta(eB,e$,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){to(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e8.create("server-app-deleted")}}let tt="12.6.0";function tn(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i={name:eK,automaticDataCollectionEnabled:!0,...t},r=i.name;if("string"!=typeof r||!r)throw e8.create("bad-app-name",{appName:String(r)});if(n||(n=F()),!n)throw e8.create("no-options");let s=eY.get(r);if(s)if(eh(n,s.options)&&eh(i,s.config))return s;else throw e8.create("duplicate-app",{appName:r});let o=new eT(r);for(let e of eQ.values())o.addComponent(e);let a=new e9(n,i,o);return eY.set(r,a),a}function ti(e,t={}){let n;if(("undefined"!=typeof window||G())&&!G())throw e8.create("invalid-server-app-environment");let i=t||{};if(e&&(e6(e)?n=e.options:e2(e)?i=e:n=e),void 0===i.automaticDataCollectionEnabled&&(i.automaticDataCollectionEnabled=!0),n||(n=F()),!n)throw e8.create("no-options");let r={...i,...n};if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==i.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw e8.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=eJ.get(s);if(o)return o.incRefCount(i.releaseOnDeref),o;let a=new eT(s);for(let e of eQ.values())a.addComponent(e);let l=new te(n,i,s,a);return eJ.set(s,l),l}function tr(e=eK){let t=eY.get(e);if(!t&&e===eK&&F())return tn();if(!t)throw e8.create("no-app",{appName:e});return t}function ts(){return Array.from(eY.values())}async function to(e){let t=!1,n=e.name;eY.has(n)?(t=!0,eY.delete(n)):eJ.has(n)&&0>=e.decRefCount()&&(eJ.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function ta(e,t,n){let i=eG[e]??e;n&&(i+=`-${n}`);let r=i.match(/\s|\//),s=t.match(/\s|\//);if(r||s){let e=[`Unable to register library "${i}" with version "${t}":`];r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ez.warn(e.join(" "));return}e0(new eC(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function tl(e,t){if(null!==e&&"function"!=typeof e)throw e8.create("invalid-log-argument");for(let n of eE){let i=null;t&&t.level&&(i=ek[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(i??t.logLevel)&&e({level:y[n].toLowerCase(),message:s,args:r,type:t.name})}}}function th(e){eE.forEach(t=>{t.setLogLevel(e)})}let tc="firebase-heartbeat-store",tu=null;function td(){return tu||(tu=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=ej(o);return i&&o.addEventListener("upgradeneeded",e=>{i(ej(o.result),e.oldVersion,e.newVersion,ej(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tc)}catch(e){console.warn(e)}}}).catch(e=>{throw e8.create("idb-open",{originalErrorMessage:e.message})})),tu}async function tp(e){try{let t=(await td()).transaction(tc),n=await t.objectStore(tc).get(tm(e));return await t.done,n}catch(e){if(e instanceof Q)ez.warn(e.message);else{let t=e8.create("idb-get",{originalErrorMessage:e?.message});ez.warn(t.message)}}}async function tf(e,t){try{let n=(await td()).transaction(tc,"readwrite"),i=n.objectStore(tc);await i.put(t,tm(e)),await n.done}catch(e){if(e instanceof Q)ez.warn(e.message);else{let t=e8.create("idb-set",{originalErrorMessage:e?.message});ez.warn(t.message)}}}function tm(e){return`${e.name}!${e.options.appId}`}class t_{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ty(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tg();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ez.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tg(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tv(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tv(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=D(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return ez.warn(e),""}}}function tg(){return new Date().toISOString().substring(0,10)}class ty{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tp(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tf(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tv(e){return D(JSON.stringify({version:2,heartbeats:e})).length}function tw(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}e0(new eC("platform-logger",e=>new eV(e),"PRIVATE")),e0(new eC("heartbeat",e=>new t_(e),"PRIVATE")),ta(eB,e$,""),ta(eB,e$,"esm2020"),ta("fire-js",""),e.s(["SDK_VERSION",()=>tt,"_DEFAULT_ENTRY_NAME",()=>eK,"_addComponent",()=>eX,"_addOrOverwriteComponent",()=>eZ,"_apps",()=>eY,"_clearComponents",()=>e5,"_components",()=>eQ,"_getProvider",()=>e1,"_isFirebaseApp",()=>e6,"_isFirebaseServerApp",()=>e4,"_isFirebaseServerAppSettings",()=>e2,"_registerComponent",()=>e0,"_removeServiceInstance",()=>e3,"_serverApps",()=>eJ,"deleteApp",()=>to,"getApp",()=>tr,"getApps",()=>ts,"initializeApp",()=>tn,"initializeServerApp",()=>ti,"onLog",()=>tl,"registerVersion",()=>ta,"setLogLevel",()=>th],92953);let tC=new X("auth","Firebase",tw()),tb=new eR("@firebase/auth");function tI(e,...t){tb.logLevel<=y.ERROR&&tb.error(`Auth (${tt}): ${e}`,...t)}function tT(e,...t){throw tN(e,...t)}function tE(e,...t){return tN(e,...t)}function tk(e,t,n){return new X("auth","Firebase",{...tw(),[t]:n}).create(t,{appName:e.name})}function tS(e){return tk(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tN(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return tC.create(e,...t)}function tP(e,t,...n){if(!e)throw tN(t,...n)}function tR(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tI(t),Error(t)}function tx(){return"undefined"!=typeof self&&self.location?.href||""}function tA(){return"undefined"!=typeof self&&self.location?.protocol||null}class tO{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tR(n),this.isMobile=K()||Y()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tA()||"https:"===tA()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tD(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||tR(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class tL{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void tR("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void tR("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void tR("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tM={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tj=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tF=new tO(3e4,6e4);function tU(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function tq(e,t,n,i,r={}){return tW(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=eu({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...r};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&W(e.emulatorConfig.host)&&(l.credentials="include"),tL.fetch()(await tV(e,e.config.apiHost,n,o),l)})}async function tW(e,t,n){e._canInitEmulator=!1;let i={...tM,...t};try{let t=new tB(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw t$(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw t$(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw t$(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw t$(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tk(e,o,n);tT(e,o)}}catch(t){if(t instanceof Q)throw t;tT(e,"network-request-failed",{message:String(t)})}}async function tH(e,t,n,i,r={}){let s=await tq(e,t,n,i,r);return"mfaPendingCredential"in s&&tT(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function tV(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?tD(e.config,r):`${e.config.apiScheme}://${r}`;return tj.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class tB{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tE(this.auth,"network-request-failed")),tF.get())})}}function t$(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=tE(e,t,i);return r.customData._tokenResponse=n,r}function tz(e){return void 0!==e&&void 0!==e.enterprise}class tK{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function tG(e,t){return tq(e,"GET","/v2/recaptchaConfig",tU(e,t))}async function tY(e,t){return tq(e,"POST","/v1/accounts:delete",t)}async function tJ(e,t){return tq(e,"POST","/v1/accounts:lookup",t)}function tQ(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tX(e,t=!1){let n=ew(e),i=await n.getIdToken(t),r=t0(i);tP(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:tQ(tZ(r.auth_time)),issuedAtTime:tQ(tZ(r.iat)),expirationTime:tQ(tZ(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function tZ(e){return 1e3*Number(e)}function t0(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return tI("JWT malformed, contained fewer than 3 sections"),null;try{let e=L(n);if(!e)return tI("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tI("Caught error parsing JWT payload as JSON",e?.toString()),null}}function t1(e){let t=t0(e);return tP(t,"internal-error"),tP(void 0!==t.exp,"internal-error"),tP(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function t3(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof Q&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class t6{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class t2{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tQ(this.lastLoginAt),this.creationTime=tQ(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function t4(e){var t,n;let i=e.auth,r=await e.getIdToken(),s=await t3(e,tJ(i,{idToken:r}));tP(s?.users.length,i,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?t8(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new t2(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&c})}async function t5(e){let t=ew(e);await t4(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function t8(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function t9(e,t){let n=await tW(e,{},async()=>{let n=eu({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await tV(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&W(e.emulatorConfig.host)&&(a.credentials="include"),tL.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function t7(e,t){return tq(e,"POST","/v2/accounts:revokeToken",tU(e,t))}class ne{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tP(e.idToken,"internal-error"),tP(void 0!==e.idToken,"internal-error"),tP(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):t1(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tP(0!==e.length,"internal-error");let t=t1(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tP(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await t9(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new ne;return n&&(tP("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(tP("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(tP("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ne,this.toJSON())}_performRefresh(){return tR("not implemented")}}function nt(e,t){tP("string"==typeof e||void 0===e,"internal-error",{appName:t})}class nn{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new t6(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new t2(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await t3(this,this.stsTokenManager.getToken(this.auth,e));return tP(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tX(this,e)}reload(){return t5(this)}_assign(e){this!==e&&(tP(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new nn({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tP(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await t4(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(e4(this.auth.app))return Promise.reject(tS(this.auth));let e=await this.getIdToken();return await t3(this,tY(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:c,emailVerified:u,isAnonymous:d,providerData:p,stsTokenManager:f}=t;tP(c&&f,e,"internal-error");let m=ne.fromJSON(this.name,f);tP("string"==typeof c,e,"internal-error"),nt(n,e.name),nt(i,e.name),tP("boolean"==typeof u,e,"internal-error"),tP("boolean"==typeof d,e,"internal-error"),nt(r,e.name),nt(s,e.name),nt(o,e.name),nt(a,e.name),nt(l,e.name),nt(h,e.name);let _=new nn({uid:c,auth:e,email:i,emailVerified:u,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:r,tenantId:o,stsTokenManager:m,createdAt:l,lastLoginAt:h});return p&&Array.isArray(p)&&(_.providerData=p.map(e=>({...e}))),a&&(_._redirectEventId=a),_}static async _fromIdTokenResponse(e,t,n=!1){let i=new ne;i.updateFromServerResponse(t);let r=new nn({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await t4(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];tP(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?t8(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!r?.length,o=new ne;o.updateFromIdToken(n);let a=new nn({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new t2(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length}),a}}let ni=new Map;function nr(e){var t,n;t="Expected a class definition",e instanceof Function||tR(t);let i=ni.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||tR(n)):(i=new e,ni.set(e,i)),i}class ns{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function no(e,t,n){return`firebase:${e}:${t}:${n}`}ns.type="NONE";class na{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=no(this.userKey,i.apiKey,r),this.fullPersistenceKey=no("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await tJ(this.auth,{idToken:e}).catch(()=>void 0);return t?nn._fromGetAccountInfoResponse(this.auth,t,e):null}return nn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new na(nr(ns),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||nr(ns),s=no(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await tJ(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await nn._fromGetAccountInfoResponse(e,n,t)}else i=nn._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch{}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch{}}))),new na(r,e,n)}}function nl(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(nd(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nf(t))return"Blackberry";if(nm(t))return"Webos";if(nc(t))return"Safari";if((t.includes("chrome/")||nu(t))&&!t.includes("edge/"))return"Chrome";if(np(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function nh(e=z()){return/firefox\//i.test(e)}function nc(e=z()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nu(e=z()){return/crios\//i.test(e)}function nd(e=z()){return/iemobile/i.test(e)}function np(e=z()){return/android/i.test(e)}function nf(e=z()){return/blackberry/i.test(e)}function nm(e=z()){return/webos/i.test(e)}function n_(e=z()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function ng(e=z()){return n_(e)||np(e)||nm(e)||nf(e)||/windows phone/i.test(e)||nd(e)}function ny(e,t=[]){let n;switch(e){case"Browser":n=nl(z());break;case"Worker":n=`${nl(z())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tt}/${i}`}class nv{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function nw(e,t={}){return tq(e,"GET","/v2/passwordPolicy",tU(e,t))}class nC{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class nb{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nI(this),this.idTokenSubscription=new nI(this),this.beforeStateQueue=new nv(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tC,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=nr(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await na.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await tJ(this,{idToken:e}),n=await nn._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(e4(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===r)&&s?.user&&(n=s.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(tP(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await t4(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(e4(this.app))return Promise.reject(tS(this));let t=e?ew(e):null;return t&&tP(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tP(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return e4(this.app)?Promise.reject(tS(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return e4(this.app)?Promise.reject(tS(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(nr(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nC(await nw(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new X("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await t7(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&nr(e)||this._popupRedirectResolver;tP(t,this,"argument-error"),this.redirectPersistenceManager=await na.create(this,[nr(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tP(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tP(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ny(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(e4(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){tb.logLevel<=y.WARN&&tb.warn(`Auth (${tt}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class nI{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new em(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return tP(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nT={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nE(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nk{constructor(){this.enterprise=new nS}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nS{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let nN="NO_RECAPTCHA";class nP{constructor(e){this.type="recaptcha-enterprise",this.auth=ew(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{tG(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new tK(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;tz(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(nN)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nk().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&tz(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=nT.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,nT.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function nR(e,t,n,i=!1,r=!1){let s,o=new nP(e);if(r)s=nN;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nx(e,t,n,i,r){if("EMAIL_PASSWORD_PROVIDER"===r)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await nR(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await nR(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let r=await nR(e,t,n);return i(e,r).catch(async r=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await nR(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await nR(e,t,n,!1,!0);return i(e,r)}}async function nA(e){let t=ew(e),n=new tK(await tG(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new nP(t).verify()}function nO(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nD(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nL{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tR("not implemented")}_getIdTokenResponse(e){return tR("not implemented")}_linkToIdToken(e,t){return tR("not implemented")}_getReauthenticationResolver(e){return tR("not implemented")}}async function nM(e,t){return tq(e,"POST","/v1/accounts:signUp",t)}async function nj(e,t){return tH(e,"POST","/v1/accounts:signInWithPassword",tU(e,t))}async function nF(e,t){return tH(e,"POST","/v1/accounts:signInWithEmailLink",tU(e,t))}async function nU(e,t){return tH(e,"POST","/v1/accounts:signInWithEmailLink",tU(e,t))}class nq extends nL{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new nq(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new nq(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nx(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nj,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nF(e,{email:this._email,oobCode:this._password});default:tT(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nx(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nM,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nU(e,{idToken:t,email:this._email,oobCode:this._password});default:tT(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nW(e,t){return tH(e,"POST","/v1/accounts:signInWithIdp",tU(e,t))}class nH extends nL{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new nH(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tT("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...i}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let r=new nH(t,n);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return nW(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nW(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nW(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eu(t)}return e}}async function nV(e,t){return tq(e,"POST","/v1/accounts:sendVerificationCode",tU(e,t))}async function nB(e,t){return tH(e,"POST","/v1/accounts:signInWithPhoneNumber",tU(e,t))}async function n$(e,t){let n=await tH(e,"POST","/v1/accounts:signInWithPhoneNumber",tU(e,t));if(n.temporaryProof)throw t$(e,"account-exists-with-different-credential",n);return n}let nz={USER_NOT_FOUND:"user-not-found"};async function nK(e,t){return tH(e,"POST","/v1/accounts:signInWithPhoneNumber",tU(e,{...t,operation:"REAUTH"}),nz)}class nG extends nL{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new nG({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new nG({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return n$(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return nK(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new nG({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class nY{constructor(e){const t=ed(ep(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tP(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,i,r=(n=(t=ed(ep(e)).link)?ed(ep(t)).deep_link_id:null,((i=ed(ep(e)).deep_link_id)?ed(ep(i)).link:null)||i||n||t||e);try{return new nY(r)}catch{return null}}}class nJ{constructor(){this.providerId=nJ.PROVIDER_ID}static credential(e,t){return nq._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=nY.parseLink(t);return tP(n,"argument-error"),nq._fromEmailAndCode(e,n.code,n.tenantId)}}nJ.PROVIDER_ID="password",nJ.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nJ.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nQ{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nX extends nQ{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nZ extends nX{constructor(){super("facebook.com")}static credential(e){return nH._fromParams({providerId:nZ.PROVIDER_ID,signInMethod:nZ.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nZ.credentialFromTaggedObject(e)}static credentialFromError(e){return nZ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nZ.credential(e.oauthAccessToken)}catch{return null}}}nZ.FACEBOOK_SIGN_IN_METHOD="facebook.com",nZ.PROVIDER_ID="facebook.com";class n0 extends nX{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nH._fromParams({providerId:n0.PROVIDER_ID,signInMethod:n0.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return n0.credentialFromTaggedObject(e)}static credentialFromError(e){return n0.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return n0.credential(t,n)}catch{return null}}}n0.GOOGLE_SIGN_IN_METHOD="google.com",n0.PROVIDER_ID="google.com";class n1 extends nX{constructor(){super("github.com")}static credential(e){return nH._fromParams({providerId:n1.PROVIDER_ID,signInMethod:n1.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return n1.credentialFromTaggedObject(e)}static credentialFromError(e){return n1.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return n1.credential(e.oauthAccessToken)}catch{return null}}}n1.GITHUB_SIGN_IN_METHOD="github.com",n1.PROVIDER_ID="github.com";class n3 extends nX{constructor(){super("twitter.com")}static credential(e,t){return nH._fromParams({providerId:n3.PROVIDER_ID,signInMethod:n3.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return n3.credentialFromTaggedObject(e)}static credentialFromError(e){return n3.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return n3.credential(t,n)}catch{return null}}}async function n6(e,t){return tH(e,"POST","/v1/accounts:signUp",tU(e,t))}n3.TWITTER_SIGN_IN_METHOD="twitter.com",n3.PROVIDER_ID="twitter.com";class n2{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new n2({user:await nn._fromIdTokenResponse(e,n,i),providerId:n4(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new n2({user:e,providerId:n4(n),_tokenResponse:n,operationType:t})}}function n4(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function n5(e){if(e4(e.app))return Promise.reject(tS(e));let t=ew(e);if(await t._initializationPromise,t.currentUser?.isAnonymous)return new n2({user:t.currentUser,providerId:null,operationType:"signIn"});let n=await n6(t,{returnSecureToken:!0}),i=await n2._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(i.user),i}class n8 extends Q{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,n8.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new n8(e,t,n,i)}}function n9(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw n8._fromErrorAndOperation(e,n,t,i);throw n})}async function n7(e,t,n=!1){let i=await t3(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return n2._forOperation(e,"link",i)}async function ie(e,t,n=!1){let{auth:i}=e;if(e4(i.app))return Promise.reject(tS(i));let r="reauthenticate";try{let s=await t3(e,n9(i,r,t,e),n);tP(s.idToken,i,"internal-error");let o=t0(s.idToken);tP(o,i,"internal-error");let{sub:a}=o;return tP(e.uid===a,i,"user-mismatch"),n2._forOperation(e,r,s)}catch(e){throw e?.code==="auth/user-not-found"&&tT(i,"user-mismatch"),e}}async function it(e,t,n=!1){if(e4(e.app))return Promise.reject(tS(e));let i="signIn",r=await n9(e,i,t),s=await n2._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}class ii{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ir._fromServerResponse(e,t):"totpInfo"in t?is._fromServerResponse(e,t):tT(e,"internal-error")}}class ir extends ii{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ir(t)}}class is extends ii{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new is(t)}}async function io(e,t){return tq(e,"POST","/v1/accounts:update",t)}async function ia(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;let i=ew(e),r=await i.getIdToken(),s=await t3(i,io(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=s.displayName||null,i.photoURL=s.photoUrl||null;let o=i.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),await i._updateTokensIfNecessary(s)}function il(e,t){return tq(e,"POST","/v2/accounts/mfaEnrollment:start",tU(e,t))}new WeakMap;let ih="__sak";class ic{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(ih,"1"),this.storage.removeItem(ih),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class iu extends ic{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=ng(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=z()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}iu.type="LOCAL";class id extends ic{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}id.type="SESSION";class ip{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new ip(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!r?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function im(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ip.receivers=[];class i_{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=im("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function ig(){return window}function iy(){return void 0!==ig().WorkerGlobalScope&&"function"==typeof ig().importScripts}async function iv(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let iw="firebaseLocalStorageDb",iC="firebaseLocalStorage",ib="fbase_key";class iI{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function iT(e,t){return e.transaction([iC],t?"readwrite":"readonly").objectStore(iC)}function iE(){let e=indexedDB.open(iw,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(iC,{keyPath:ib})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(iC)?t(n):(n.close(),await new iI(indexedDB.deleteDatabase(iw)).toPromise(),t(await iE()))})})}async function ik(e,t,n){return new iI(iT(e,!0).put({[ib]:t,value:n})).toPromise()}async function iS(e,t){let n=iT(e,!1).get(t),i=await new iI(n).toPromise();return void 0===i?null:i.value}function iN(e,t){return new iI(iT(e,!0).delete(t)).toPromise()}class iP{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await iE()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return iy()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ip._getInstance(iy()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await iv(),!this.activeServiceWorker)return;this.sender=new i_(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await iE();return await ik(e,ih,"1"),await iN(e,ih),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ik(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>iS(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>iN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new iI(iT(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function iR(e,t){return tq(e,"POST","/v2/accounts/mfaSignIn:start",tU(e,t))}iP.type="LOCAL",nE("rcb"),new tO(3e4,6e4);let ix="recaptcha";async function iA(e,t,n){if(!e._getRecaptchaConfig())try{await nA(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){tP("enroll"===t.type,e,"internal-error");let r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===nN){tP(n?.type===ix,e,"argument-error");let i=await iO(e,t,n);return il(e,i)}return il(e,t)},o=nx(e,r,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tP("signin"===t.type,e,"internal-error");let r=i.multiFactorHint?.uid||i.multiFactorUid;tP(r,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===nN){tP(n?.type===ix,e,"argument-error");let i=await iO(e,t,n);return iR(e,i)}return iR(e,t)},a=nx(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=async(e,t)=>{if(t.captchaResponse===nN){tP(n?.type===ix,e,"argument-error");let i=await iO(e,t,n);return nV(e,i)}return nV(e,t)},s=nx(e,t,"sendVerificationCode",r,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function iO(e,t,n){tP(n.type===ix,e,"argument-error");let i=await n.verify();tP("string"==typeof i,e,"argument-error");let r={...t};if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class iD{constructor(e){this.providerId=iD.PROVIDER_ID,this.auth=ew(e)}verifyPhoneNumber(e,t){return iA(this.auth,e,ew(t))}static credential(e,t){return nG._fromVerification(e,t)}static credentialFromResult(e){return iD.credentialFromTaggedObject(e)}static credentialFromError(e){return iD.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?nG._fromTokenResponse(t,n):null}}iD.PROVIDER_ID="phone",iD.PHONE_SIGN_IN_METHOD="phone";class iL extends nL{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nW(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nW(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nW(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function iM(e){return it(e.auth,new iL(e),e.bypassAuthState)}function ij(e){let{auth:t,user:n}=e;return tP(n,t,"internal-error"),ie(n,new iL(e),e.bypassAuthState)}async function iF(e){let{auth:t,user:n}=e;return tP(n,t,"internal-error"),n7(n,new iL(e),e.bypassAuthState)}class iU{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return iM;case"linkViaPopup":case"linkViaRedirect":return iF;case"reauthViaPopup":case"reauthViaRedirect":return ij;default:tT(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tR(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tR(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let iq=new tO(2e3,1e4);class iW extends iU{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,iW.currentPopupAction&&iW.currentPopupAction.cancel(),iW.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tP(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tR(t);let n=im();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tE(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tE(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,iW.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tE(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,iq.get())};e()}}iW.currentPopupAction=null;let iH=new Map;class iV extends iU{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=iH.get(this.auth._key());if(!e){try{let t=await iB(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}iH.set(this.auth._key(),e)}return this.bypassAuthState||iH.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function iB(e,t){var n;let i=no("pendingRedirect",(n=t).config.apiKey,n.name),r=nr(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function i$(e,t){iH.set(e._key(),t)}async function iz(e,t,n=!1){if(e4(e.app))return Promise.reject(tS(e));let i=ew(e),r=t?nr(t):(tP(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new iV(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class iK{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return iY(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!iY(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tE(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(iG(e))}saveEventToCache(e){this.cachedEventUids.add(iG(e)),this.lastProcessedEventTime=Date.now()}}function iG(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function iY({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function iJ(e,t={}){return tq(e,"GET","/v1/projects",t)}let iQ=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,iX=/^https?/;async function iZ(e){if(e.config.emulator)return;let{authorizedDomains:t}=await iJ(e);for(let e of t)try{if(function(e){let t=tx(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!iX.test(n))return!1;if(iQ.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch{}tT(e,"unauthorized-domain")}let i0=new tO(3e4,6e4);function i1(){let e=ig().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let i3=null,i6=new tO(5e3,15e3),i2={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},i4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function i5(e){let t,n,i,r,s,o=await (i3=i3||new Promise((t,n)=>{function i(){i1(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{i1(),n(tE(e,"network-request-failed"))},timeout:i0.get()})}if(ig().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(ig().gapi?.load)i();else{var r;let t=nE("iframefcb");return ig()[t]=()=>{gapi.load?i():n(tE(e,"network-request-failed"))},(r=`${nT.gapiScript}?onload=${t}`,nT.loadJS(r)).catch(e=>n(e))}}).catch(e=>{throw i3=null,e})),a=ig().gapi;return tP(a,e,"internal-error"),o.open({where:document.body,url:(tP((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?tD(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:tt},(r=i4.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${eu(i).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:i2,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=tE(e,"network-request-failed"),s=ig().setTimeout(()=>{i(r)},i6.get());function o(){ig().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let i8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class i9{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let i7=encodeURIComponent("fac");async function re(e,t,n,i,r,s){tP(e.config.authDomain,e,"auth-domain-config-required"),tP(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:tt,eventId:r};if(t instanceof nQ)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",ea(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof nX){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${i7}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tD(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eu(o).slice(1)}${l}`}let rt="webStorageSupport",rn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=id,this._completeRedirectFn=iz,this._overrideRedirectResult=i$}async _openPopup(e,t,n,i){var r,s;r=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",r||tR(s);let o=await re(e,t,n,tx(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l={...i8,width:i.toString(),height:r.toString(),top:s,left:o},h=z().toLowerCase();n&&(a=nu(h)?"_blank":n),nh(h)&&(t=t||"http://localhost",l.scrollbars="yes");let c=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=z()){return n_(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var u,d;let e,n;return u=t||"",d=a,(e=document.createElement("a")).href=u,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new i9(null)}let p=window.open(t||"",a,c);tP(p,e,"popup-blocked");try{p.focus()}catch(e){}return new i9(p)}(e,o,im())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await re(e,t,n,tx(),i),ig().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||tR(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await i5(e),n=new iK(e);return t.register("authEvent",t=>(tP(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(rt,{type:rt},n=>{let i=n?.[0]?.[rt];void 0!==i&&t(!!i),tT(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=iZ(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return ng()||nc()||n_()}};var ri="@firebase/auth",rr="1.12.0";class rs{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tP(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let ro=U("authIdTokenMaxAge")||300,ra=null;nT={loadJS:e=>new Promise((t,n)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=tE("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},_="Browser",e0(new eC("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;tP(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h=new nb(r,s,o,{apiKey:a,authDomain:l,clientPlatform:_,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ny(_)});return i=(Array.isArray(n=t?.persistence||[])?n:[n]).map(nr),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),e0(new eC("auth-internal",e=>new rs(ew(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),ta(ri,rr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(_)),ta(ri,rr,"esm2020"),e.s([],58556),e.i(58556),ta("firebase","12.7.0","app"),e.i(92953);let rl="@firebase/database",rh="1.1.0",rc="";class ru{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),et(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ee(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class rd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return es(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let rp=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new ru(t)}}catch(e){}return new rd},rf=rp("localStorage"),rm=rp("sessionStorage"),r_=new eR("@firebase/database"),rg=(p=1,function(){return p++}),ry=function(e){let t=ey(e),n=new ef;n.update(t);let i=n.digest();return x.encodeByteArray(i)},rv=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=rv.apply(null,i):"object"==typeof i?t+=et(i):t+=i,t+=" "}return t},rw=null,rC=!0,rb=function(e,t){S(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(r_.logLevel=y.VERBOSE,rw=r_.log.bind(r_),t&&rm.set("logging_enabled",!0)):"function"==typeof e?rw=e:(rw=null,rm.remove("logging_enabled"))},rI=function(...e){if(!0===rC&&(rC=!1,null===rw&&!0===rm.get("logging_enabled")&&rb(!0)),rw){let t=rv.apply(null,e);rw(t)}},rT=function(e){return function(...t){rI(e,...t)}},rE=function(...e){let t="FIREBASE INTERNAL ERROR: "+rv(...e);r_.error(t)},rk=function(...e){let t=`FIREBASE FATAL ERROR: ${rv(...e)}`;throw r_.error(t),Error(t)},rS=function(...e){let t="FIREBASE WARNING: "+rv(...e);r_.warn(t)},rN=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&rS("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},rP=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},rR=function(e){if(J()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},rx="[MIN_NAME]",rA="[MAX_NAME]",rO=function(e,t){if(e===t)return 0;{if(e===rx||t===rA)return -1;if(t===rx||e===rA)return 1;let n=rW(e),i=rW(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},rD=function(e,t){return e===t?0:e<t?-1:1},rL=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+et(t))},rM=function(e){if("object"!=typeof e||null===e)return et(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=et(t[i]),n+=":",n+=rM(e[t[i]]);return n+"}"},rj=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function rF(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let rU=function(e){let t,n,i,r,s;S(!rP(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},rq=RegExp("^-?(0*)\\d{1,10}$"),rW=function(e){if(rq.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},rH=function(e){try{e()}catch(e){setTimeout(()=>{throw rS("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},rV=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class rB{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,e4(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){rS(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class r${constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(rI("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',rS(e)}}class rz{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}rz.OWNER="owner";let rK=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,rG="websocket",rY="long_polling";class rJ{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=rf.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&rf.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function rQ(e,t,n){let i;if(S("string"==typeof t,"typeof type must == string"),S("object"==typeof n,"typeof params must == object"),t===rG)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===rY)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return rF(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class rX{constructor(){this.counters_={}}incrementCounter(e,t=1){es(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let rZ={},r0={};function r1(e){let t=e.toString();return rZ[t]||(rZ[t]=new rX),rZ[t]}class r3{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&rH(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let r6="start";class r2{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rT(e),this.stats_=r1(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),rQ(t,rY,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new r3(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),rR(()=>{if(this.isClosed_)return;this.scriptTagHolder=new r4((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===r6)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[r6]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&rK.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){r2.forceAllow_=!0}static forceDisallow(){r2.forceDisallow_=!0}static isAvailable(){return!J()&&(!!r2.forceAllow_||!r2.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=et(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=rj(O(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(J())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=et(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class r4{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,J())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=rg(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=r4.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){rI("frame writing exception"),e.stack&&rI(e.stack),rI(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rI("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){J()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{rI("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let r5=null;"undefined"!=typeof MozWebSocket?r5=MozWebSocket:"undefined"!=typeof WebSocket&&(r5=WebSocket);class r8{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rT(this.connId),this.stats_=r1(t),this.connURL=r8.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!J()&&"undefined"!=typeof location&&location.hostname&&rK.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),rQ(e,rG,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,rf.set("previous_websocket_failure",!0);try{let e;if(J()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${rc}/${k.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=k.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new r5(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){r8.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==r5&&!r8.forceDisallow_}static previouslyFailed(){return rf.isInMemoryStorage||!0===rf.get("previous_websocket_failure")}markConnectionHealthy(){rf.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ee(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(S(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=et(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=rj(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}r8.responsesRequiredToBeHealthy=2,r8.healthyTimeout=3e4;class r9{static get ALL_TRANSPORTS(){return[r2,r8]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=r8&&r8.isAvailable(),n=t&&!r8.previouslyFailed();if(e.webSocketOnly&&(t||rS("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[r8];else{let e=this.transports_=[];for(let t of r9.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);r9.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}r9.globalTransportInitialized_=!1;class r7{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rT("c:"+this.id+":"),this.transportManager_=new r9(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=rV(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=rL("t",e),n=rL("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=rL("t",e),n=rL("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=rL("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?rE("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):rE("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&rS("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),rV(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rV(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(rf.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class se{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class st{constructor(e){this.allowedEvents_=e,this.listeners_={},S(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){S(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class sn extends st{static getInstance(){return new sn}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||K()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return S("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class si{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function sr(){return new si("")}function ss(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function so(e){return e.pieces_.length-e.pieceNum_}function sa(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new si(e.pieces_,t)}function sl(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function sh(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function sc(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new si(t,0)}function su(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof si)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new si(n,0)}function sd(e){return e.pieceNum_>=e.pieces_.length}function sp(e,t){let n=ss(e),i=ss(t);if(null===n)return t;if(n===i)return sp(sa(e),sa(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function sf(e,t){let n=sh(e,0),i=sh(t,0);for(let e=0;e<n.length&&e<i.length;e++){let t=rO(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function sm(e,t){if(so(e)!==so(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function s_(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(so(e)>so(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class sg{constructor(e,t){this.errorPrefix_=t,this.parts_=sh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=ev(this.parts_[e]);sy(this)}}function sy(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+sv(e))}function sv(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class sw extends st{static getInstance(){return new sw}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return S("visible"===e,"Unknown event type: "+e),[this.visible_]}}class sC extends se{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=sC.nextPersistentConnectionId_++,this.log_=rT("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!J())throw Error("Auth override specified in options, but not supported on non Node.js platforms");sw.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&sn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(et(r)),S(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new q,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),S(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),S(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;sC.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&es(e,"w")){let n=eo(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();rS(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||er(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ei(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),S(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+et(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):rE("Unrecognized action received from server: "+et(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){S(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+sC.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){S(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?rI("getToken() completed but was canceled"):(rI("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new r7(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{rS(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&rS(e),a())}}}interrupt(e){rI("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rI("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ea(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>rM(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new si(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){rI("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){rI("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";J()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+rc.replace(/\./g,"-")]=1,K()?e["framework.cordova"]=1:Y()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=sn.getInstance().currentlyOnline();return ea(this.interruptReasons_)&&e}}sC.nextPersistentConnectionId_=0,sC.nextConnectionId_=0;class sb{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new sb(e,t)}}class sI{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new sb(rx,e),i=new sb(rx,t);return 0!==this.compare(n,i)}minPost(){return sb.MIN}}class sT extends sI{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return rO(e.name,t.name)}isDefinedOn(e){throw N("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return sb.MIN}maxPost(){return new sb(rA,i)}makePost(e,t){return S("string"==typeof e,"KeyIndex indexValue must always be a string."),new sb(e,i)}toString(){return".key"}}let sE=new sT;class sk{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class sS{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:sS.RED,this.left=null!=i?i:sN.EMPTY_NODE,this.right=null!=r?r:sN.EMPTY_NODE}copy(e,t,n,i,r){return new sS(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return sN.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return sN.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,sS.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,sS.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}sS.RED=!0,sS.BLACK=!1;class sN{constructor(e,t=sN.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new sN(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,sS.BLACK,null,null))}remove(e){return new sN(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,sS.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new sk(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new sk(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new sk(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new sk(this.root_,null,this.comparator_,!0,e)}}function sP(e,t){return rO(e.name,t.name)}function sR(e,t){return rO(e,t)}sN.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new sS(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let sx=function(e){return"number"==typeof e?"number:"+rU(e):"string:"+e},sA=function(e){if(e.isLeafNode()){let t=e.val();S("string"==typeof t||"number"==typeof t||"object"==typeof t&&es(t,".sv"),"Priority must be a string or number.")}else S(e===r||e.isEmpty(),"priority of unexpected type.");S(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class sO{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=sO.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,S(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),sA(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new sO(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:sO.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return sd(e)?this:".priority"===ss(e)?this.priorityNode_:sO.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:sO.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=ss(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(S(".priority"!==n||1===so(e),".priority must be the last token in a path"),this.updateImmediateChild(n,sO.__childrenNodeConstructor.EMPTY_NODE.updateChild(sa(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+sx(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=rU(this.value_):e+=this.value_,this.lazyHash_=ry(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===sO.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof sO.__childrenNodeConstructor?-1:(S(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=sO.VALUE_TYPE_ORDER.indexOf(t),r=sO.VALUE_TYPE_ORDER.indexOf(n);return(S(i>=0,"Unknown leaf type: "+t),S(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}sO.VALUE_TYPE_ORDER=["object","boolean","number","string"];let sD=new class extends sI{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?rO(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return sb.MIN}maxPost(){return new sb(rA,new sO("[PRIORITY-POST]",a))}makePost(e,t){return new sb(t,new sO("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},sL=Math.log(2);class sM{constructor(e){this.count=parseInt(Math.log(e+1)/sL,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let sj=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new sS(n?n(s):s,s.node,sS.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new sS(n?n(s):s,s.node,sS.BLACK,l,h)}};return new sN(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),c=e[s];l(new sS(n?n(c):c,c.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,sS.BLACK):(a(i,sS.BLACK),a(i,sS.RED))}return s}(new sM(e.length)))},sF={};class sU{static get Default(){return S(sF&&sD,"ChildrenNode.ts has not been loaded"),l=l||new sU({".priority":sF},{".priority":sD})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eo(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof sN?t:null}hasIndex(e){return es(this.indexSet_,e.toString())}addIndex(e,t){let n;S(e!==sE,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(sb.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?sj(i,e.getCompare()):sF;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new sU(h,l)}addToIndexes(e,t){return new sU(el(this.indexes_,(n,i)=>{let r=eo(this.indexSet_,i);if(S(r,"Missing index implementation for "+i),n===sF)if(!r.isDefinedOn(e.node))return sF;else{let n=[],i=t.getIterator(sb.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),sj(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new sb(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new sU(el(this.indexes_,n=>{if(n===sF)return n;{let i=t.get(e.name);return i?n.remove(new sb(e.name,i)):n}}),this.indexSet_)}}class sq{static get EMPTY_NODE(){return h||(h=new sq(new sN(sR),null,sU.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&sA(this.priorityNode_),this.children_.isEmpty()&&S(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new sq(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=ss(e);return null===t?this:this.getImmediateChild(t).getChild(sa(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(S(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new sb(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new sq(n,s,i)}}updateChild(e,t){let n=ss(e);if(null===n)return t;{S(".priority"!==ss(e)||1===so(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(sa(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(sD,(s,o)=>{t[s]=o.val(e),n++,r&&sq.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+sx(this.getPriority().val())+":"),this.forEachChild(sD,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":ry(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new sb(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new sb(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new sb(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,sb.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,sb.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===sW?-1:0}withIndex(e){if(e===sE||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new sq(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===sE||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(sD),n=e.getIterator(sD),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===sE?null:this.indexMap_.get(e.toString())}}sq.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let sW=new class extends sq{constructor(){super(new sN(sR),sq.EMPTY_NODE,sU.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return sq.EMPTY_NODE}isEmpty(){return!1}};function sH(e,t=null){if(null===e)return sq.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),S(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new sO(e,sH(t));if(e instanceof Array){let n=sq.EMPTY_NODE;return rF(e,(t,i)=>{if(es(e,t)&&"."!==t.substring(0,1)){let e=sH(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(sH(t))}{let n=[],i=!1;if(rF(e,(e,t)=>{if("."!==e.substring(0,1)){let r=sH(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new sb(e,r)))}}),0===n.length)return sq.EMPTY_NODE;let r=sj(n,sP,e=>e.name,sR);if(!i)return new sq(r,sH(t),sU.Default);{let e=sj(n,sD.getCompare());return new sq(r,sH(t),new sU({".priority":e},{".priority":sD}))}}}Object.defineProperties(sb,{MIN:{value:new sb(rx,sq.EMPTY_NODE)},MAX:{value:new sb(rA,sW)}}),sT.__EMPTY_NODE=sq.EMPTY_NODE,sO.__childrenNodeConstructor=sq,r=sW,a=sW,o=sH;class sV extends sI{constructor(e){super(),this.indexPath_=e,S(!sd(e)&&".priority"!==ss(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?rO(e.name,t.name):r}makePost(e,t){let n=sH(e);return new sb(t,sq.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new sb(rA,sq.EMPTY_NODE.updateChild(this.indexPath_,sW))}toString(){return sh(this.indexPath_,0).join("/")}}let sB=new class extends sI{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?rO(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return sb.MIN}maxPost(){return sb.MAX}makePost(e,t){return new sb(t,sH(e))}toString(){return".value"}};function s$(e){return{type:"value",snapshotNode:e}}function sz(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function sK(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function sG(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class sY{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){S(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(sK(t,o)):S(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(sz(t,n)):s.trackChildChange(sG(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(sD,(e,i)=>{t.hasChild(e)||n.trackChildChange(sK(e,i))}),t.isLeafNode()||t.forEachChild(sD,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(sG(t,i,r))}else n.trackChildChange(sz(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?sq.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class sJ{constructor(e){this.indexedFilter_=new sY(e.getIndex()),this.index_=e.getIndex(),this.startPost_=sJ.getStartPost_(e),this.endPost_=sJ.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new sb(t,n))||(n=sq.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=sq.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(sq.EMPTY_NODE);let r=this;return t.forEachChild(sD,(e,t)=>{r.matches(new sb(e,t))||(i=i.updateImmediateChild(e,sq.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class sQ{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new sJ(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new sb(t,n))||(n=sq.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=sq.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=sq.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(sq.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,sq.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();S(e.numChildren()===this.limit_,"");let o=new sb(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),c=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=c&&(c.name===t||e.hasChild(c.name));)c=i.getChildAfterChild(this.index_,c,this.reverse_);let u=null==c?1:s(c,o);if(l&&!n.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(sG(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(sK(t,h));let n=e.updateImmediateChild(t,sq.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(sz(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(sK(a.name,a.node)),r.trackChildChange(sz(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,sq.EMPTY_NODE)):e:e}}class sX{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=sD}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return S(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(S(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:rx}hasEnd(){return this.endSet_}getIndexEndValue(){return S(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(S(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:rA}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return S(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===sD}copy(){let e=new sX;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function sZ(e){let t,n={};if(e.isDefault())return n;if(e.index_===sD?t="$priority":e.index_===sB?t="$value":e.index_===sE?t="$key":(S(e.index_ instanceof sV,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=et(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=et(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+et(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=et(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+et(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function s0(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==sD&&(t.i=e.index_.toString()),t}class s1 extends se{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(S(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=rT("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=s1.getListenId_(e,n),o={};this.listens_[s]=o;let a=sZ(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),eo(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=s1.getListenId_(e,t);delete this.listens_[n]}get(e){let t=sZ(e._queryParams),n=e._path.toString(),i=new q;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eu(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ee(o.responseText)}catch(e){rS("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&rS("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class s3{constructor(){this.rootNode_=sq.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function s6(){return{value:null,children:new Map}}function s2(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{s2(i,new si(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class s4{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&rF(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class s5{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new s4(e);const n=1e4+2e4*Math.random();rV(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;rF(e,(e,i)=>{i>0&&es(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),rV(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function s8(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function s9(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function s7(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(g=v||(v={}))[g.OVERWRITE=0]="OVERWRITE",g[g.MERGE=1]="MERGE",g[g.ACK_USER_WRITE=2]="ACK_USER_WRITE",g[g.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class oe{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=v.ACK_USER_WRITE,this.source=s8()}operationForChild(e){if(!sd(this.path))return S(ss(this.path)===e,"operationForChild called for unrelated child."),new oe(sa(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return S(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new si(e));return new oe(sr(),t,this.revert)}}}class ot{constructor(e,t){this.source=e,this.path=t,this.type=v.LISTEN_COMPLETE}operationForChild(e){return sd(this.path)?new ot(this.source,sr()):new ot(this.source,sa(this.path))}}class on{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=v.OVERWRITE}operationForChild(e){return sd(this.path)?new on(this.source,sr(),this.snap.getImmediateChild(e)):new on(this.source,sa(this.path),this.snap)}}class oi{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=v.MERGE}operationForChild(e){if(!sd(this.path))return S(ss(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new oi(this.source,sa(this.path),this.children);{let t=this.children.subtree(new si(e));return t.isEmpty()?null:t.value?new on(this.source,sr(),t.value):new oi(this.source,sr(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class or{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(sd(e))return this.isFullyInitialized()&&!this.filtered_;let t=ss(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class os{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function oo(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw N("Should only compare child_ events.");let i=new sb(t.childName,t.snapshotNode),r=new sb(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function oa(e,t){return{eventCache:e,serverCache:t}}function ol(e,t,n,i){return oa(new or(t,n,i),e.serverCache)}function oh(e,t,n,i){return oa(e.eventCache,new or(t,n,i))}function oc(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ou(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class od{static fromObject(e){let t=new od(null);return rF(e,(e,n)=>{t=t.set(new si(e),n)}),t}constructor(e,t=(!c&&(c=new sN(rD)),c)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:sr(),value:this.value};{if(sd(e))return null;let n=ss(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(sa(e),t);return null!=r?{path:su(new si(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(sd(e))return this;{let t=ss(e),n=this.children.get(t);return null!==n?n.subtree(sa(e)):new od(null)}}set(e,t){if(sd(e))return new od(t,this.children);{let n=ss(e),i=(this.children.get(n)||new od(null)).set(sa(e),t),r=this.children.insert(n,i);return new od(this.value,r)}}remove(e){if(sd(e))if(this.children.isEmpty())return new od(null);else return new od(null,this.children);{let t=ss(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(sa(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new od(null):new od(this.value,i)}}}get(e){if(sd(e))return this.value;{let t=ss(e),n=this.children.get(t);return n?n.get(sa(e)):null}}setTree(e,t){if(sd(e))return t;{let n,i=ss(e),r=(this.children.get(i)||new od(null)).setTree(sa(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new od(this.value,n)}}fold(e){return this.fold_(sr(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(su(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,sr(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(sd(e))return null;let i=ss(e),r=this.children.get(i);return r?r.findOnPath_(sa(e),su(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,sr(),t)}foreachOnPath_(e,t,n){if(sd(e))return this;{this.value&&n(t,this.value);let i=ss(e),r=this.children.get(i);return r?r.foreachOnPath_(sa(e),su(t,i),n):new od(null)}}foreach(e){this.foreach_(sr(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(su(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class op{constructor(e){this.writeTree_=e}static empty(){return new op(new od(null))}}function of(e,t,n){if(sd(t))return new op(new od(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=sp(r,t);return s=s.updateChild(o,n),new op(e.writeTree_.set(r,s))}{let i=new od(n);return new op(e.writeTree_.setTree(t,i))}}}function om(e,t,n){let i=e;return rF(n,(e,n)=>{i=of(i,su(t,e),n)}),i}function o_(e,t){return sd(t)?op.empty():new op(e.writeTree_.setTree(t,new od(null)))}function og(e,t){return null!=oy(e,t)}function oy(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(sp(n.path,t)):null}function ov(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(sD,(e,n)=>{t.push(new sb(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new sb(e,n.value))}),t}function ow(e,t){if(sd(t))return e;{let n=oy(e,t);return new op(null!=n?new od(n):e.writeTree_.subtree(t))}}function oC(e){return e.writeTree_.isEmpty()}function ob(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(S(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(su(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(su(t,".priority"),r)),i}}(sr(),e.writeTree_,t)}function oI(e){return e.visible}function oT(e,t,n){let i=op.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)s_(n,t)?i=of(i,e=sp(n,t),s.snap):s_(t,n)&&(e=sp(t,n),i=of(i,sr(),s.snap.getChild(e)));else if(s.children){if(s_(n,t))i=om(i,e=sp(n,t),s.children);else if(s_(t,n))if(sd(e=sp(t,n)))i=om(i,sr(),s.children);else{let t=eo(s.children,ss(e));if(t){let n=t.getChild(sa(e));i=of(i,sr(),n)}}}else throw N("WriteRecord should have .snap or .children")}}return i}function oE(e,t,n,i,r){if(i||r){let s=ow(e.visibleWrites,t);return!r&&oC(s)?n:r||null!=n||og(s,sr())?ob(oT(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(s_(e.path,t)||s_(t,e.path))},t),n||sq.EMPTY_NODE):null}{let i=oy(e.visibleWrites,t);if(null!=i)return i;{let i=ow(e.visibleWrites,t);return oC(i)?n:null!=n||og(i,sr())?ob(i,n||sq.EMPTY_NODE):null}}}function ok(e,t,n,i){return oE(e.writeTree,e.treePath,t,n,i)}function oS(e,t){return function(e,t,n){let i=sq.EMPTY_NODE,r=oy(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(sD,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return ov(ow(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=ow(e.visibleWrites,t);return n.forEachChild(sD,(e,t)=>{let n=ob(ow(r,new si(e)),t);i=i.updateImmediateChild(e,n)}),ov(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function oN(e,t,n,i){return function(e,t,n,i,r){S(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=su(t,n);if(og(e.visibleWrites,s))return null;{let t=ow(e.visibleWrites,s);return oC(t)?r.getChild(n):ob(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function oP(e,t){var n,i;return n=e.writeTree,i=su(e.treePath,t),oy(n.visibleWrites,i)}function oR(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=su(r,t),null!=(o=oy(i.visibleWrites,s))?o:n.isCompleteForChild(t)?ob(ow(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function ox(e,t){return oA(su(e.treePath,t),e.writeTree)}function oA(e,t){return{treePath:e,writeTree:t}}class oO{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;S("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),S(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,sG(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,sK(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,sz(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,sG(n,e.snapshotNode,i.oldSnap));else throw N("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let oD=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class oL{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new or(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return oR(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ou(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=ow(e.visibleWrites,t),h=oy(l,sr());if(null!=h)a=h;else{if(null==n)return[];a=ob(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function oM(e,t,n,i,r,s){let o=t.eventCache;if(null!=oP(i,n))return t;{let a,l;if(sd(n))if(S(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=ou(t),r=oS(i,n instanceof sq?n:sq.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=ok(i,ou(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=ss(n);if(".priority"===h){S(1===so(n),"Can't have a priority with additional path components");let r=o.getNode(),s=oN(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let c,u=sa(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=oN(i,n,o.getNode(),l);c=null!=e?o.getNode().getImmediateChild(h).updateChild(u,e):o.getNode().getImmediateChild(h)}else c=oR(i,h,t.serverCache);a=null!=c?e.filter.updateChild(o.getNode(),h,c,u,r,s):o.getNode()}}return ol(t,a,o.isFullyInitialized()||sd(n),e.filter.filtersNodes())}}function oj(e,t,n,i,r,s,o,a){let l,h=t.serverCache,c=o?e.filter:e.filter.getIndexedFilter();if(sd(n))l=c.updateFullNode(h.getNode(),i,null);else if(c.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=c.updateFullNode(h.getNode(),e,null)}else{let e=ss(n);if(!h.isCompleteForPath(n)&&so(n)>1)return t;let r=sa(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?c.updatePriority(h.getNode(),s):c.updateChild(h.getNode(),e,s,r,oD,null)}let u=oh(t,l,h.isFullyInitialized()||sd(n),c.filtersNodes()),d=new oL(r,u,s);return oM(e,u,n,r,d,a)}function oF(e,t,n,i,r,s,o){let a,l,h=t.eventCache,c=new oL(r,t,s);if(sd(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=ol(t,l,!0,e.filter.filtersNodes());else{let r=ss(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=ol(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=sa(n),u=h.getNode().getImmediateChild(r);if(sd(l))s=i;else{let e=c.getCompleteChild(r);s=null!=e?".priority"===sl(l)&&e.getChild(sc(l)).isEmpty()?e:e.updateChild(l,i):sq.EMPTY_NODE}a=u.equals(s)?t:ol(t,e.filter.updateChild(h.getNode(),r,s,l,c,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function oU(e,t){return e.eventCache.isCompleteForChild(t)}function oq(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function oW(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=sd(n)?i:new od(null).setTree(n,i);let c=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(c.hasChild(n)){let l=oq(e,t.serverCache.getNode().getImmediateChild(n),i);h=oj(e,h,new si(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!c.hasChild(n)&&!l){let l=oq(e,t.serverCache.getNode().getImmediateChild(n),i);h=oj(e,h,new si(n),l,r,s,o,a)}}),h}class oH{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new sY(n.getIndex()),r=function(e){return e.loadsAllData()?new sY(e.getIndex()):e.hasLimit()?new sQ(e):new sJ(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(sq.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(sq.EMPTY_NODE,o.getNode(),null),h=new or(a,s.isFullyInitialized(),i.filtersNodes()),c=new or(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=oa(c,h),this.eventGenerator_=new os(this.query_)}get query(){return this.query_}}function oV(e){return 0===e.eventRegistrations_.length}function oB(e,t,n){let i=[];if(n){S(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function o$(e,t,n,i){var r,s;t.type===v.MERGE&&null!==t.source.queryId&&(S(ou(e.viewCache_),"We should always have a full cache before handling merges"),S(oc(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,c,u,d,p,f,m,_;let g,y,w=new oO;if(n.type===v.OVERWRITE)n.source.fromUser?g=oF(e,t,n.path,n.snap,i,r,w):(S(n.source.fromServer,"Unknown source."),y=n.source.tagged||t.serverCache.isFiltered()&&!sd(n.path),g=oj(e,t,n.path,n.snap,i,r,y,w));else if(n.type===v.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,c=r,u=w,d=o,l.foreach((e,t)=>{let n=su(a,e);oU(o,ss(n))&&(d=oF(s,d,n,t,h,c,u))}),l.foreach((e,t)=>{let n=su(a,e);oU(o,ss(n))||(d=oF(s,d,n,t,h,c,u))}),g=d):(S(n.source.fromServer,"Unknown source."),y=n.source.tagged||t.serverCache.isFiltered(),g=oW(e,t,n.path,n.children,i,r,y,w))}else if(n.type===v.ACK_USER_WRITE)g=n.revert?function(e,t,n,i,r,s){let o;if(null!=oP(i,n))return t;{let a,l=new oL(i,t,r),h=t.eventCache.getNode();if(sd(n)||".priority"===ss(n)){let n;if(t.serverCache.isFullyInitialized())n=ok(i,ou(t));else{let e=t.serverCache.getNode();S(e instanceof sq,"serverChildren would be complete if leaf node"),n=oS(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=ss(n),c=oR(i,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),(a=null!=c?e.filter.updateChild(h,r,c,sa(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,sq.EMPTY_NODE,sa(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=ok(i,ou(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=oP(i,sr()),ol(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,w):function(e,t,n,i,r,s,o){if(null!=oP(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(sd(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return oj(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!sd(n))return t;let i=new od(null);return l.getNode().forEachChild(sE,(e,t)=>{i=i.set(new si(e),t)}),oW(e,t,n,i,r,s,a,o)}{let h=new od(null);return i.foreach((e,t)=>{let i=su(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),oW(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,w);else if(n.type===v.LISTEN_COMPLETE){let r;d=e,p=t,f=n.path,m=i,_=w,r=p.serverCache,g=oM(d,oh(p,r.getNode(),r.isFullyInitialized()||sd(f),r.isFiltered()),f,m,oD,_)}else throw N("Unknown operation type: "+n.type);let C=w.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=oc(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(s$(oc(t)))}}(t,g,C),{viewCache:g,changes:C}}(e.processor_,o,t,n,i);return r=e.processor_,S((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),S(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),S(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,oz(e,a.changes,a.viewCache.eventCache.getNode(),null)}function oz(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),oo(r,s,"child_removed",t,a,n),oo(r,s,"child_added",t,a,n),oo(r,s,"child_moved",o,a,n),oo(r,s,"child_changed",t,a,n),oo(r,s,"value",t,a,n),s}class oK{constructor(){this.views=new Map}}function oG(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return S(null!=s,"SyncTree gave us an op for an invalid query."),o$(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(o$(s,t,n,i));return r}}function oY(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=ok(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof sq?oS(n,i):sq.EMPTY_NODE,s=!1),new oH(t,oa(new or(e,s,!1),new or(i,r,!1)))}return o}function oJ(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function oQ(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=ou(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!sd(t)&&!n.getImmediateChild(ss(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function oX(e,t){if(t._queryParams.loadsAllData())return o0(e);{let n=t._queryIdentifier;return e.views.get(n)}}function oZ(e){return null!=o0(e)}function o0(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let o1=1;class o3{constructor(e){this.listenProvider_=e,this.syncPointTree_=new od(null),this.pendingWriteTree_={visibleWrites:op.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function o6(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,S(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=of(s.visibleWrites,t,n)),s.lastWriteId=i,r)?ae(e,new on(s8(),t,n)):[]}function o2(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);S(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return s_(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&s_(su(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:s_(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=oT(n.allWrites,oI,sr()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=o_(e.visibleWrites,r.path):rF(r.children,t=>{e.visibleWrites=o_(e.visibleWrites,su(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new od(null);return null!=i.snap?t=t.set(sr(),!0):rF(i.children,e=>{t=t.set(new si(e),!0)}),ae(e,new oe(i.path,t,n))}}function o4(e,t,n){return ae(e,new on(s9(),t,n))}function o5(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=oX(o,t))){let c=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=oZ(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(oB(r,n,i)),oV(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(oB(t,n,i)),oV(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!oZ(e)&&s.push(new(S(u,"Reference.ts has not been loaded"),u)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=c.removed;if(a=c.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>oZ(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&oZ(t))return[o0(t)];{let e=[];return t&&(e=oJ(t)),rF(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=at(e,i);e.listenProvider_.startListening(aa(r),an(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(aa(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(ai(t));e.listenProvider_.stopListening(aa(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=ai(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function o8(e,t,n,i){let r=ar(e,i);if(null==r)return[];{let i=as(r),s=i.path,o=i.queryId,a=sp(s,t);return ao(e,s,new on(s7(o),a,n))}}function o9(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,c=null,u=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=sp(e,h);c=c||oQ(t,n),u=u||oZ(t)});let d=e.syncPointTree_.get(h);d?(u=u||oZ(d),c=c||oQ(d,sr())):(d=new oK,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=c?s=!0:(s=!1,c=sq.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=oQ(t,sr());n&&(c=c.updateImmediateChild(e,n))}));let p=null!=oX(d,t);if(!p&&!t._queryParams.loadsAllData()){let n=ai(t);S(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=o1++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let f=oA(h,e.pendingWriteTree_),m=(o=oY(r=d,t,f,c,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(sD,(e,t)=>{l.push(sz(e,t))}),a.isFullyInitialized()&&l.push(s$(a.getNode())),oz(o,l,a.getNode(),n));if(!p&&!u&&!i){let n=oX(d,t);m=m.concat(function(e,t,n){let i=t._path,r=an(e,t),s=at(e,n),o=e.listenProvider_.startListening(aa(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)S(!oZ(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!sd(e)&&t&&oZ(t))return[o0(t).query];{let e=[];return t&&(e=e.concat(oJ(t).map(e=>e.query))),rF(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(aa(i),an(e,i))}}return o}(e,t,n))}return m}function o7(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=oQ(n,sp(e,t));if(i)return i});return oE(i,t,r,n,!0)}function ae(e,t){var n;return function e(t,n,i,r){if(sd(t.path))return function e(t,n,i,r){let s=n.get(sr());null==i&&null!=s&&(i=oQ(s,sr()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=ox(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(oG(s,t,r,i))),o}(t,n,i,r);{let s=n.get(sr());null==i&&null!=s&&(i=oQ(s,sr()));let o=[],a=ss(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=ox(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(oG(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,oA(sr(),n)))}function at(e,t){let n=t.query,i=an(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||sq.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=ar(e,n);if(!i)return[];{let n=as(i),r=n.path,s=n.queryId,o=sp(r,t);return ao(e,r,new ot(s7(s),o))}}(e,n._path,i);else return r=n._path,ae(e,new ot(s9(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return o5(e,n,null,s)}}}}function an(e,t){let n=ai(t);return e.queryToTagMap.get(n)}function ai(e){return e._path.toString()+"$"+e._queryIdentifier}function ar(e,t){return e.tagToQueryMap.get(t)}function as(e){let t=e.indexOf("$");return S(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new si(e.substr(0,t))}}function ao(e,t,n){let i=e.syncPointTree_.get(t);return S(i,"Missing sync point for query tag that we're tracking"),oG(i,n,oA(t,e.pendingWriteTree_),null)}function aa(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(S(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class al{constructor(e){this.node_=e}getImmediateChild(e){return new al(this.node_.getImmediateChild(e))}node(){return this.node_}}class ah{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=su(this.path_,e);return new ah(this.syncTree_,t)}node(){return o7(this.syncTree_,this.path_)}}let ac=function(e,t,n){return e&&"object"==typeof e?(S(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?au(e[".sv"],t,n):"object"==typeof e[".sv"]?ad(e[".sv"],t):void S(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},au=function(e,t,n){if("timestamp"===e)return n.timestamp;S(!1,"Unexpected server value: "+e)},ad=function(e,t,n){e.hasOwnProperty("increment")||S(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&S(!1,"Unexpected increment value: "+i);let r=t.node();if(S(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},ap=function(e,t,n,i){return am(t,new ah(n,e),i)},af=function(e,t,n){return am(e,new al(t),n)};function am(e,t,n){let i,r=ac(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new sO(r))),e.forEachChild(sD,(e,r)=>{let s=am(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=ac(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new sO(i,sH(r)):e}}class a_{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function ag(e,t){let n=t instanceof si?t:new si(t),i=e,r=ss(n);for(;null!==r;){let e=eo(i.node.children,r)||{children:{},childCount:0};i=new a_(r,i,e),r=ss(n=sa(n))}return i}function ay(e){return e.node.value}function av(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===ay(i)&&!aw(i),s=es(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function aw(e){return e.node.childCount>0}function aC(e,t){rF(e.node.children,(n,i)=>{t(new a_(n,e,i))})}function ab(e){return new si(null===e.parent?e.name:ab(e.parent)+"/"+e.name)}let aI=/[\[\].#$\/\u0000-\u001F\u007F]/,aT=/[\[\].#$\u0000-\u001F\u007F]/,aE=function(e){return"string"==typeof e&&0!==e.length&&!aI.test(e)},ak=function(e){return"string"==typeof e&&0!==e.length&&!aT.test(e)},aS=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!rP(e)||e&&"object"==typeof e&&es(e,".sv")},aN=function(e,t,n,i){i&&void 0===t||aP(eg(e,"value"),t,n)},aP=function(e,t,n){let i=n instanceof si?new sg(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+sv(i));if("function"==typeof t)throw Error(e+"contains a function "+sv(i)+" with contents = "+t.toString());if(rP(t))throw Error(e+"contains "+t.toString()+" "+sv(i));if("string"==typeof t&&t.length>3495253.3333333335&&ev(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+sv(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(rF(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!aE(t)))throw Error(e+" contains an invalid key ("+t+") "+sv(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=ev(t),sy(i),aP(e,s,i),o=i.parts_.pop(),i.byteLength_-=ev(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+sv(i)+" in addition to actual children.")}},aR=function(e,t){let n,i;for(n=0;n<t.length;n++){let r=sh(i=t[n]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!aE(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(sf);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&s_(r,i))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},ax=function(e,t,n,i){if(i&&void 0===t)return;let r=eg(e,"values");if(!(t&&"object"==typeof t)||Array.isArray(t))throw Error(r+" must be an object containing the children to replace.");let s=[];rF(t,(e,t)=>{let i=new si(e);if(aP(r,t,su(n,i)),".priority"===sl(i)&&!aS(t))throw Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(i)}),aR(r,s)},aA=function(e,t,n,i){if((!i||void 0!==n)&&!ak(n))throw Error(eg(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},aO=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),aA(e,t,n,i)},aD=function(e,t){if(".info"===ss(t))throw Error(e+" failed = Can't modify data under /.info/")},aL=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!aE(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!ak(n)))throw Error(eg(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class aM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function aj(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||sm(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function aF(e,t,n){aj(e,n),aq(e,e=>sm(e,t))}function aU(e,t,n){aj(e,n),aq(e,e=>s_(e,t)||s_(t,e))}function aq(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();rw&&rI("event: "+n.toString()),rH(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class aW{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=s6(),this.transactionQueueTree_=new a_,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function aH(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new si(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function aV(e,t,n,i,r){e.dataUpdateCount++;let s=new si(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=el(n,e=>sH(e));o=function(e,t,n,i){let r=ar(e,i);if(!r)return[];{let i=as(r),s=i.path,o=i.queryId,a=sp(s,t),l=od.fromObject(n);return ao(e,s,new oi(s7(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=sH(n);o=o8(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=el(n,e=>sH(e));a=e.serverSyncTree_,t=od.fromObject(i),o=ae(a,new oi(s9(),s,t))}else{let t=sH(n);o=o4(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=aQ(e,s)),aU(e.eventQueue_,l,o)}function aB(e,t){var n;let i,r,s;a$(e,"connected",t),!1===t&&(aG(n=e,"onDisconnectEvents"),i=aH(n),r=s6(),s2(n.onDisconnect_,sr(),(e,t)=>{let s=ap(e,t,n.serverSyncTree_,i);!function e(t,n,i){if(sd(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=ss(n);t.children.has(r)||t.children.set(r,s6()),e(t.children.get(r),n=sa(n),i)}}(r,e,s)}),s=[],s2(r,sr(),(e,t)=>{s=s.concat(o4(n.serverSyncTree_,e,t));let i=a1(n,e);aQ(n,i)}),n.onDisconnect_=s6(),aU(n.eventQueue_,sr(),s))}function a$(e,t,n){let i=new si("/.info/"+t),r=sH(n);e.infoData_.updateSnapshot(i,r);let s=o4(e.infoSyncTree_,i,r);aU(e.eventQueue_,i,s)}function az(e){return e.nextWriteId_++}function aK(e,t,n){let i;i=".info"===ss(t._path)?o5(e.infoSyncTree_,t,n):o5(e.serverSyncTree_,t,n),aF(e.eventQueue_,t._path,i)}function aG(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),rI(n,...t)}function aY(e,t,n,i){t&&rH(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),r=e;i&&(r+=": "+i);let s=Error(r);s.code=e,t(s)}})}function aJ(e,t,n){return o7(e.serverSyncTree_,t,n)||sq.EMPTY_NODE}function aQ(e,t){let n=aX(e,t),i=ab(n),r=aZ(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=sp(n,a.path),h=!1,c;if(S(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,c=a.abortReason,r=r.concat(o2(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,c="maxretry",r=r.concat(o2(e.serverSyncTree_,a.currentWriteId,!0));else{let n=aJ(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){aP("transaction failed: Data returned ",i,a.path);let t=sH(i);"object"==typeof i&&null!=i&&es(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=af(t,n,aH(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=az(e),s.splice(s.indexOf(o),1),r=(r=r.concat(o6(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(o2(e.serverSyncTree_,o,!0))}else h=!0,c="nodata",r=r.concat(o2(e.serverSyncTree_,a.currentWriteId,!0))}aU(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===c?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(c),!1,null))))}a0(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)rH(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||a0(t,n),ay(n)){let i=aZ(t,n);S(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=aJ(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];S(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=sp(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{aG(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(o2(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();a0(t,ag(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),aU(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)rH(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{rS("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}aQ(t,n)}},o)}(t,ab(n),i)}else aw(n)&&aC(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function aX(e,t){let n,i=e.transactionQueueTree_;for(n=ss(t);null!==n&&void 0===ay(i);)i=ag(i,n),n=ss(t=sa(t));return i}function aZ(e,t){let n=[];return function e(t,n,i){let r=ay(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);aC(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function a0(e,t){let n=ay(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,av(t,n.length>0?n:void 0)}aC(t,t=>{a0(e,t)})}function a1(e,t){let n=ab(aX(e,t)),i=ag(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{a3(e,t)}),a3(e,i),!function e(t,n,i,r){i&&!r&&n(t),aC(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{a3(e,t)}),n}function a3(e,t){let n=ay(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(S(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(S(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(o2(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?av(t,void 0):n.length=s+1,aU(e.eventQueue_,ab(t),r);for(let e=0;e<i.length;e++)rH(i[e])}}let a6=function(e,t){let n=a2(e),i=n.namespace;"firebase.com"===n.domain&&rk(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||rk("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||rN();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new rJ(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new si(n.pathString)}},a2=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,u)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):rS(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let p=t.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};class a4{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+et(this.snapshot.exportVal())}}class a5{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class a8{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return S(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class a9{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return sd(this._path)?null:sl(this._path)}get ref(){return new a7(this._repo,this._path)}get _queryIdentifier(){let e=rM(s0(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return s0(this._queryParams)}isEqual(e){if(!((e=ew(e))instanceof a9))return!1;let t=this._repo===e._repo,n=sm(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class a7 extends a9{constructor(e,t){super(e,t,new sX,!1)}get parent(){let e=sc(this._path);return null===e?null:new a7(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class le{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new si(e),n=ln(this.ref,e);return new le(this._node.getChild(t),n,sD)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new le(n,ln(this.ref,t),sD)))}hasChild(e){let t=new si(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function lt(e,t){return(e=ew(e))._checkNotDeleted("ref"),void 0!==t?ln(e._root,t):e._root}function ln(e,t){return null===ss((e=ew(e))._path)?aO("child","path",t,!1):aA("child","path",t,!1),new a7(e._repo,su(e._path,t))}function li(e,t){var n,i,r;let s,o,a,l,h,c;aD("set",(e=ew(e))._path),aN("set",t,e._path,!1);let u=new q;return n=e._repo,i=e._path,r=u.wrapCallback(()=>{}),aG(n,"set",{path:i.toString(),value:t,priority:null}),s=aH(n),a=af(o=sH(t,null),o7(n.serverSyncTree_,i),s),l=az(n),h=o6(n.serverSyncTree_,i,a,l,!0),aj(n.eventQueue_,h),n.server_.put(i.toString(),o.val(!0),(e,t)=>{let s="ok"===e;s||rS("set at "+i+" failed: "+e);let o=o2(n.serverSyncTree_,l,!s);aU(n.eventQueue_,i,o),aY(n,r,e,t)}),c=a1(n,i),aQ(n,c),aU(n.eventQueue_,c,[]),u.promise}function lr(e){var t,n,i,r,s;let o,a,l,h,c,u,d;e=ew(e);let p=new ls(new a8(()=>{}));return(t=e._repo,n=e,i=t.serverSyncTree_,a=(r=n)._path,l=null,i.syncPointTree_.foreachOnPath(a,(e,t)=>{let n=sp(e,a);l=l||oQ(t,n)}),(h=i.syncPointTree_.get(a))?l=l||oQ(h,sr()):(h=new oK,i.syncPointTree_=i.syncPointTree_.set(a,h)),u=(c=null!=l)?new or(l,!0,!1):null,d=(s=i.pendingWriteTree_,oA(r._path,s)),null!=(o=oc(oY(h,r,d,c?u.getNode():sq.EMPTY_NODE,c).viewCache_))?Promise.resolve(o):t.server_.get(n).then(e=>{let i,r=sH(e).withIndex(n._queryParams.getIndex());if(o9(t.serverSyncTree_,n,p,!0),n._queryParams.loadsAllData())i=o4(t.serverSyncTree_,n._path,r);else{let e=an(t.serverSyncTree_,n);i=o8(t.serverSyncTree_,n._path,r,e)}return aU(t.eventQueue_,n._path,i),o5(t.serverSyncTree_,n,p,null,!0),r},e=>(aG(t,"get for query "+et(n)+" failed: "+e),Promise.reject(Error(e))))).then(t=>new le(t,new a7(e._repo,e._path),e._queryParams.getIndex()))}class ls{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new a4("value",this,new le(e.snapshotNode,new a7(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new a5(this,e,t):null}matches(e){return e instanceof ls&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class lo{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new a5(this,e,t):null}createEvent(e,t){S(null!=e.childName,"Child events should have a childName.");let n=ln(new a7(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new a4(e.type,this,new le(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof lo&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}class la{}class ll extends la{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){var t,n;let i;if(e._queryParams.hasLimit())throw Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new a9(e._repo,e._path,(t=e._queryParams,n=this._limit,(i=t.copy()).limitSet_=!0,i.limit_=n,i.viewFrom_="l",i),e._orderByCalled)}}class lh extends la{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){var t;let n;if(!0===e._orderByCalled)throw Error("orderByChild: You can't combine multiple orderBy calls.");let i=new si(this._path);if(sd(i))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new sV(i),s=(t=e._queryParams,(n=t.copy()).index_=r,n),o=null,a=null;if(s.hasStart()&&(o=s.getIndexStartValue()),s.hasEnd()&&(a=s.getIndexEndValue()),s.getIndex()===sE){let e="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",t="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(s.hasStart()){if(s.getIndexStartName()!==rx)throw Error(e);if("string"!=typeof o)throw Error(t)}if(s.hasEnd()){if(s.getIndexEndName()!==rA)throw Error(e);if("string"!=typeof a)throw Error(t)}}else if(s.getIndex()===sD){if(null!=o&&!aS(o)||null!=a&&!aS(a))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(S(s.getIndex()instanceof sV||s.getIndex()===sB,"unknown index type."),null!=o&&"object"==typeof o||null!=a&&"object"==typeof a)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.");return new a9(e._repo,e._path,s,!0)}}S(!u,"__referenceConstructor has already been defined"),u=a7,S(!d,"__referenceConstructor has already been defined"),d=a7;let lc={};class lu{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=r1(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new s1(e.repoInfo_,(t,n,i,r)=>{aV(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>aB(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{et(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new sC(e.repoInfo_,t,(t,n,i,r)=>{aV(e,t,n,i,r)},t=>{aB(e,t)},t=>{var n;n=e,rF(t,(e,t)=>{a$(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,r0[r=i.toString()]||(r0[r]=(()=>new s5(e.stats_,e.server_))()),e.statsReporter_=r0[r],e.infoData_=new s3,e.infoSyncTree_=new o3({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=o4(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),a$(e,"connected",!1),e.serverSyncTree_=new o3({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);aU(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new a7(this._repo,sr())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=lc[t=this.app.name])&&n[e.key]===e||rk(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&rk("Cannot call "+e+" on a deleted database.")}}sC.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},sC.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},rc=tt,e0(new eC("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let o,a,l,h,c,u,d,p=e.getProvider("app").getImmediate(),f=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return void 0===(l=t||p.options.databaseURL)&&(p.options.projectId||rk("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rI("Using default host for project ",p.options.projectId),l=`${p.options.projectId}-default-rtdb.firebaseio.com`),c=(h=a6(l,void 0)).repoInfo,void 0!==k.default&&k.default.env&&(u=k.default.env.FIREBASE_DATABASE_EMULATOR_HOST),u?c=(h=a6(l=`http://${u}?ns=${c.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new r$(p.name,p.options,f),aL("Invalid Firebase Database URL",h),sd(h.path)||rk("Database URL must point to the root of a Firebase Database (not including a child path)."),new lu((n=c,i=p,r=d,s=new rB(p,m),(o=lc[i.name])||(o={},lc[i.name]=o),(a=o[n.toURLString()])&&rk("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new aW(n,!1,r,s),o[n.toURLString()]=a,a),p)},"PUBLIC").setMultipleInstances(!0)),ta(rl,rh,void 0),ta(rl,rh,"esm2020");let ld=0===ts().length?tn({apiKey:"AIzaSyBECQksrlWkWOTP4jriMmA9thfcKgbHyuE",authDomain:"codrcrew.firebaseapp.com",databaseURL:"https://codrcrew.firebaseio.com",projectId:"codrcrew",storageBucket:"codrcrew.appspot.com",messagingSenderId:"517463115484",appId:"1:517463115484:web:93ce55f61c78b015371619",measurementId:"G-Z9TTWE5FSJ"}):ts()[0],lp=function(e=tr()){let t=e1(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=e1(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eh(n.getOptions(),t??{}))return e;tT(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:rn,persistence:[iP,iu,id]}),i=U("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t,i=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>ro)return;let r=n?.token;ra!==r&&(ra=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});ew(n).beforeAuthStateChanged(i,()=>i(n.currentUser)),ew(n).onIdTokenChanged(e=>i(e),void 0,void 0)}}let r=j("auth");return r&&function(e,t,n){let i=ew(e);tP(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=nO(t),{host:s,port:o}=function(e){let t=nO(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:nD(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:nD(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${r}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){tP(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),tP(eh(l,i.config.emulator)&&eh(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,W(s)?(H(`${r}//${s}${a}`),$("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}(ld),lf=function(e=tr(),t){let n=e1(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=(e=>{let t=j(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){var r;let s,o,a;(e=ew(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eh(i,h.repoInfo_.emulatorOptions))return;rk("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&rk('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new rz(rz.OWNER)):i.mockUserToken&&(s=new rz("string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[D(JSON.stringify({alg:"none",type:"JWT"})),D(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId))),W(t)&&(H(t),$("Database",!0)),r=s,o=l.lastIndexOf(":"),a=W(l.substring(0,o)),h.repoInfo_=new rJ(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}(n,...e)}return n}(ld);async function lm(e){let t=await n5(lp);return await ia(t.user,{displayName:e}),t.user}function l_(){return lp.currentUser}let lg="sudoko-solver";async function ly(e,t){let n=lt(lf,`${lg}/profiles/${e}`);await li(n,{username:t,createdAt:Date.now(),bestTime:null,gamesPlayed:0})}async function lv(e){let t=lt(lf,`${lg}/profiles/${e}`),n=await lr(t);return n.exists()?n.val():null}async function lw(e,t){let n,i=lt(lf,`${lg}/profiles/${e}`);await (ax("update",t,i._path,!1),n=new q,!function(e,t,n,i){aG(e,"update",{path:t.toString(),value:n});let r=!0,s=aH(e),o={};if(rF(n,(n,i)=>{r=!1,o[n]=ap(su(t,n),sH(i),e.serverSyncTree_,s)}),r)rI("update() called with empty data.  Don't do anything."),aY(e,i,"ok",void 0);else{var a,l;let r,s=az(e),h=(a=e.serverSyncTree_,l=a.pendingWriteTree_,S(s>l.lastWriteId,"Stacking an older merge on top of newer ones"),l.allWrites.push({path:t,children:o,writeId:s,visible:!0}),l.visibleWrites=om(l.visibleWrites,t,o),l.lastWriteId=s,r=od.fromObject(o),ae(a,new oi(s8(),t,r)));aj(e.eventQueue_,h),e.server_.merge(t.toString(),n,(n,r)=>{let o="ok"===n;o||rS("update at "+t+" failed: "+n);let a=o2(e.serverSyncTree_,s,!o),l=a.length>0?aQ(e,t):t;aU(e.eventQueue_,l,a),aY(e,i,n,r)}),rF(n,n=>{let i=a1(e,su(t,n));aQ(e,i)}),aU(e.eventQueue_,t,[])}}(i._repo,i._path,t,n.wrapCallback(()=>{})),n.promise)}async function lC(e,t){let n=await lv(e);return(!n.bestTime||t<n.bestTime)&&(await lw(e,{bestTime:t}),!0)}async function lb(e){let t=await lv(e);await lw(e,{gamesPlayed:(t.gamesPlayed||0)+1})}let lI="sudoko-solver";async function lT(e,t,n){let i=lt(lf,`${lI}/leaderboard/${e}`);await li(i,{username:t,time:n,timestamp:Date.now()})}async function lE(e=10){let t=function(e,...t){let n=ew(e);for(let e of t)n=e._apply(n);return n}(lt(lf,`${lI}/leaderboard`),function(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return aA("orderByChild","path",e,!1),new lh(e)}("time"),function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw Error("limitToFirst: First argument must be a positive integer.");return new ll(e)}(e)),n=await lr(t);if(!n.exists())return[];let i=[];return n.forEach(e=>{i.push({userId:e.key,...e.val()})}),i}async function lk(e){let t=lt(lf,`${lI}/leaderboard`),n=await lr(t);if(!n.exists())return null;let i=[];n.forEach(e=>{i.push({userId:e.key,time:e.val().time})}),i.sort((e,t)=>e.time-t.time);let r=i.findIndex(t=>t.userId===e);return -1!==r?r+1:null}function lS({onStart:e}){let{startNewGame:t}=E(),n=n=>{t(n),e&&e()};return(0,w.jsxs)("div",{className:"difficulty-menu",children:[(0,w.jsx)("h1",{children:"Sudoku Solver"}),(0,w.jsx)("p",{children:"Select difficulty to start"}),(0,w.jsxs)("div",{className:"difficulty-buttons",children:[(0,w.jsx)("button",{onClick:()=>n("easy"),className:"difficulty-button",children:"Easy"}),(0,w.jsx)("button",{onClick:()=>n("medium"),className:"difficulty-button",children:"Medium"}),(0,w.jsx)("button",{onClick:()=>n("hard"),className:"difficulty-button",children:"Hard"})]})]})}let lN=function(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=function e(t){var n,i,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(n=0;n<s;n++)t[n]&&(i=e(t[n]))&&(r&&(r+=" "),r+=i)}else for(i in t)t[i]&&(r&&(r+=" "),r+=i);return r}(e))&&(i&&(i+=" "),i+=t);return i};function lP(){let{board:e,initialBoard:t,selectedCell:n,selectedNumber:i,selectCell:r,placeNumber:s,mode:o,candidates:a,settings:l,hintCell:h}=E();return e?(0,w.jsx)("div",{className:"sudoku-board",children:e.map((o,c)=>(0,w.jsx)("div",{className:"board-row",children:o.map((o,u)=>{let d,p=0!==t[c][u],f=a[`${c}-${u}`]||[];return(0,w.jsx)("div",{onClick:()=>{0===t[c][u]&&(r(c,u),null!==i&&s(c,u,i))},className:lN("cell",{"cell-fixed":p,"cell-selected":n&&n.row===c&&n.col===u,"cell-highlight-row":l.highlightRow&&n&&n.row===c,"cell-highlight-col":l.highlightColumn&&n&&n.col===u,"cell-highlight-box":l.highlightBox&&((e,t)=>{if(!n)return!1;let i=Math.floor(n.row/3),r=Math.floor(n.col/3);return Math.floor(e/3)===i&&Math.floor(t/3)===r})(c,u),"cell-identical":l.highlightIdentical&&((t,i)=>{if(!n||0===e[t][i])return!1;let r=e[n.row][n.col];return 0!==r&&e[t][i]===r})(c,u),"cell-conflict":0!==(d=e[c][u])&&I(e,c,u,d),"cell-hint":h&&h.row===c&&h.col===u,"cell-border-right":(u+1)%3==0&&8!==u,"cell-border-bottom":(c+1)%3==0&&8!==c}),children:0!==o?(0,w.jsx)("span",{className:"cell-number",children:o}):f.length>0?(0,w.jsx)("div",{className:"cell-candidates",children:[1,2,3,4,5,6,7,8,9].map(e=>(0,w.jsx)("span",{className:lN("candidate",{"candidate-active":f.includes(e)}),children:f.includes(e)?e:""},e))}):null},u)})},c))}):null}function lR(){let{selectedCell:e,selectedNumber:t,selectNumber:n,placeNumber:i,clearCell:r}=E();return(0,w.jsxs)("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(r=>(0,w.jsx)("button",{onClick:()=>{n(r),e&&i(e.row,e.col,r)},className:lN("number-button",{"number-selected":t===r}),children:r},r)),(0,w.jsx)("button",{onClick:()=>{e&&r(e.row,e.col)},className:"clear-button",children:"Clear"})]})}function lx(){let{mode:e,setMode:t,useHint:n,autoFillCandidates:i,solvePuzzle:r,undo:s,redo:o,toggleTimer:a,timerRunning:l,history:h,historyIndex:c}=E();return(0,w.jsxs)("div",{className:"game-controls",children:[(0,w.jsxs)("div",{className:"control-group",children:[(0,w.jsx)("button",{onClick:()=>t("normal"===e?"candidate":"normal"),className:"control-button",children:"normal"===e?"Normal Mode":"Pencil Mode"}),(0,w.jsx)("button",{onClick:i,className:"control-button",children:"Auto Candidates"})]}),(0,w.jsxs)("div",{className:"control-group",children:[(0,w.jsx)("button",{onClick:s,disabled:c<0,className:"control-button",children:"Undo"}),(0,w.jsx)("button",{onClick:o,disabled:c>=h.length-1,className:"control-button",children:"Redo"})]}),(0,w.jsxs)("div",{className:"control-group",children:[(0,w.jsx)("button",{onClick:n,className:"control-button",children:"Hint"}),(0,w.jsx)("button",{onClick:r,className:"control-button",children:"Solve"})]}),(0,w.jsx)("div",{className:"control-group",children:(0,w.jsx)("button",{onClick:a,className:"control-button",children:l?"Pause":"Resume"})})]})}function lA(){let e,{timer:t,errors:n,hintsUsed:i,difficulty:r,incrementTimer:s,settings:o}=E();return(0,C.useEffect)(()=>{let e=setInterval(()=>{s()},1e3);return()=>clearInterval(e)},[s]),(0,w.jsxs)("div",{className:"game-stats",children:[(0,w.jsxs)("div",{className:"stat",children:[(0,w.jsx)("span",{className:"stat-label",children:"Difficulty:"}),(0,w.jsx)("span",{className:"stat-value",children:r})]}),o.timerEnabled&&(0,w.jsxs)("div",{className:"stat",children:[(0,w.jsx)("span",{className:"stat-label",children:"Time:"}),(0,w.jsx)("span",{className:"stat-value",children:(e=Math.floor(t/60),`${e.toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`)})]}),o.errorCounterEnabled&&(0,w.jsxs)("div",{className:"stat",children:[(0,w.jsx)("span",{className:"stat-label",children:"Errors:"}),(0,w.jsx)("span",{className:"stat-value",children:n})]}),(0,w.jsxs)("div",{className:"stat",children:[(0,w.jsx)("span",{className:"stat-label",children:"Hints:"}),(0,w.jsx)("span",{className:"stat-value",children:i})]})]})}function lO({isOpen:e,onClose:t}){let{settings:n,updateSettings:i}=E();if(!e)return null;let r=e=>{i({[e]:!n[e]})};return(0,w.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,w.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("h2",{children:"Settings"}),(0,w.jsxs)("div",{className:"settings-list",children:[(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.timerEnabled,onChange:()=>r("timerEnabled")}),(0,w.jsx)("span",{children:"Enable Timer"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.errorCounterEnabled,onChange:()=>r("errorCounterEnabled")}),(0,w.jsx)("span",{children:"Enable Error Counter"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.checkOnEntry,onChange:()=>r("checkOnEntry")}),(0,w.jsx)("span",{children:"Check Guesses on Entry"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.highlightRow,onChange:()=>r("highlightRow")}),(0,w.jsx)("span",{children:"Highlight Row"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.highlightColumn,onChange:()=>r("highlightColumn")}),(0,w.jsx)("span",{children:"Highlight Column"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.highlightBox,onChange:()=>r("highlightBox")}),(0,w.jsx)("span",{children:"Highlight Box"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.highlightIdentical,onChange:()=>r("highlightIdentical")}),(0,w.jsx)("span",{children:"Highlight Identical Numbers"})]}),(0,w.jsxs)("label",{className:"setting-item",children:[(0,w.jsx)("input",{type:"checkbox",checked:n.soundEnabled,onChange:()=>r("soundEnabled")}),(0,w.jsx)("span",{children:"Enable Sound"})]})]}),(0,w.jsx)("button",{onClick:t,className:"close-button",children:"Close"})]})})}let lD="sudoko-solver";async function lL(e,t,n){let i=((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[e]];return t})(8).toUpperCase(),r=lt(lf,`${lD}/rooms/${i}`),s={code:i,host:e,hostUsername:t,difficulty:n,createdAt:Date.now(),players:{[e]:{username:t,joinedAt:Date.now()}},gameState:null};return await li(r,s),i}async function lM(e,t,n){let i=lt(lf,`${lD}/rooms/${e}`),r=await lr(i);if(!r.exists())throw Error("Room not found");let s=lt(lf,`${lD}/rooms/${e}/players/${t}`);return await li(s,{username:n,joinedAt:Date.now()}),r.val()}async function lj(e,t){let n=lt(lf,`${lD}/rooms/${e}/players/${t}`);await li(n,null)}function lF(e,t){let n=lt(lf,`${lD}/rooms/${e}`);return!function(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{aK(e._repo,e,h),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let l=new a8(n,o||void 0),h="value"===t?new ls(l):new lo(t,l);s=e._repo,a=".info"===ss(e._path)?o9(s.infoSyncTree_,e,h):o9(s.serverSyncTree_,e,h),aF(s.eventQueue_,e._path,a)}(n,"value",e=>{e.exists()&&t(e.val())},void 0,void 0),()=>{aK(n._repo,n,null)}}function lU({onRoomJoined:e}){let[t,n]=(0,C.useState)(""),[i,r]=(0,C.useState)(null),[s,o]=(0,C.useState)(""),[a,l]=(0,C.useState)(!1),h=async t=>{l(!0),o("");try{let n=l_();if(!n)return void o("Please log in first");let i=await lL(n.uid,n.displayName,t);r({code:i,difficulty:t}),lF(i,e=>{r(e)}),e&&e(i,t)}catch(e){o(e.message)}finally{l(!1)}},c=async()=>{if(!t.trim())return void o("Please enter a room code");l(!0),o("");try{let n=l_();if(!n)return void o("Please log in first");let i=await lM(t.toUpperCase(),n.uid,n.displayName);r(i),lF(t.toUpperCase(),e=>{r(e)}),e&&e(t.toUpperCase(),i.difficulty)}catch(e){o(e.message)}finally{l(!1)}},u=async()=>{if(i)try{let e=l_();e&&await lj(i.code,e.uid),r(null),n("")}catch(e){o(e.message)}};return i?(0,w.jsxs)("div",{className:"room-info",children:[(0,w.jsxs)("h3",{children:["Room: ",i.code]}),(0,w.jsxs)("p",{children:["Difficulty: ",i.difficulty]}),(0,w.jsxs)("div",{className:"players-list",children:[(0,w.jsx)("h4",{children:"Players:"}),i.players&&Object.entries(i.players).map(([e,t])=>(0,w.jsx)("div",{className:"player-item",children:t.username},e))]}),(0,w.jsx)("button",{onClick:u,className:"leave-button",children:"Leave Room"})]}):(0,w.jsxs)("div",{className:"room-manager",children:[(0,w.jsx)("h3",{children:"Multiplayer Room"}),(0,w.jsxs)("div",{className:"room-create",children:[(0,w.jsx)("h4",{children:"Create Room"}),(0,w.jsxs)("div",{className:"create-buttons",children:[(0,w.jsx)("button",{onClick:()=>h("easy"),disabled:a,children:"Easy"}),(0,w.jsx)("button",{onClick:()=>h("medium"),disabled:a,children:"Medium"}),(0,w.jsx)("button",{onClick:()=>h("hard"),disabled:a,children:"Hard"})]})]}),(0,w.jsxs)("div",{className:"room-join",children:[(0,w.jsx)("h4",{children:"Join Room"}),(0,w.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value.toUpperCase()),placeholder:"Enter room code",maxLength:8}),(0,w.jsx)("button",{onClick:c,disabled:a||!t.trim(),children:"Join"})]}),s&&(0,w.jsx)("div",{className:"error-message",children:s})]})}function lq({isOpen:e,onClose:t}){let[n,i]=(0,C.useState)([]),[r,s]=(0,C.useState)(!1);(0,C.useEffect)(()=>{e&&o()},[e]);let o=async()=>{s(!0);try{let e=await lE(10);i(e)}catch(e){console.error("Failed to load leaderboard:",e)}finally{s(!1)}};return e?(0,w.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,w.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("h2",{children:"Leaderboard"}),r?(0,w.jsx)("p",{children:"Loading..."}):0===n.length?(0,w.jsx)("p",{children:"No scores yet"}):(0,w.jsx)("div",{className:"leaderboard-list",children:n.map((e,t)=>{var n;let i;return(0,w.jsxs)("div",{className:"leaderboard-item",children:[(0,w.jsxs)("span",{className:"rank",children:["#",t+1]}),(0,w.jsx)("span",{className:"username",children:e.username}),(0,w.jsx)("span",{className:"time",children:(i=Math.floor((n=e.time)/60),`${i}:${(n%60).toString().padStart(2,"0")}`)})]},e.userId)})}),(0,w.jsx)("button",{onClick:t,className:"close-button",children:"Close"})]})}):null}function lW({isOpen:e,onClose:t}){let[n,i]=(0,C.useState)(null),[r,s]=(0,C.useState)(null),[o,a]=(0,C.useState)(!1);(0,C.useEffect)(()=>{e&&l()},[e]);let l=async()=>{a(!0);try{let e=l_();if(e){let t=await lv(e.uid);if(i(t),t?.bestTime){let t=await lk(e.uid);s(t)}}}catch(e){console.error("Failed to load profile:",e)}finally{a(!1)}};if(!e)return null;let h=l_();return(0,w.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,w.jsxs)("div",{className:"modal-content profile-modal",onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("h2",{children:"Player Profile"}),o?(0,w.jsx)("p",{children:"Loading..."}):n?(0,w.jsxs)("div",{className:"profile-content",children:[(0,w.jsxs)("div",{className:"profile-header",children:[(0,w.jsx)("div",{className:"profile-avatar",children:h?.displayName?.charAt(0).toUpperCase()||"P"}),(0,w.jsx)("h3",{children:h?.displayName||"Player"})]}),(0,w.jsxs)("div",{className:"profile-stats",children:[(0,w.jsxs)("div",{className:"profile-stat-card",children:[(0,w.jsx)("span",{className:"stat-label",children:"Games Played"}),(0,w.jsx)("span",{className:"stat-value",children:n.gamesPlayed||0})]}),(0,w.jsxs)("div",{className:"profile-stat-card",children:[(0,w.jsx)("span",{className:"stat-label",children:"Best Time"}),(0,w.jsx)("span",{className:"stat-value",children:(e=>{if(!e)return"N/A";let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`})(n.bestTime)})]}),r&&(0,w.jsxs)("div",{className:"profile-stat-card",children:[(0,w.jsx)("span",{className:"stat-label",children:"Global Rank"}),(0,w.jsxs)("span",{className:"stat-value",children:["#",r]})]}),(0,w.jsxs)("div",{className:"profile-stat-card",children:[(0,w.jsx)("span",{className:"stat-label",children:"Member Since"}),(0,w.jsx)("span",{className:"stat-value",children:new Date(n.createdAt).toLocaleDateString()})]})]})]}):(0,w.jsx)("p",{children:"No profile data available"}),(0,w.jsx)("button",{onClick:t,className:"close-button",children:"Close"})]})})}var lH=e.i(35764);function lV({isOpen:e,onClose:t}){let{currentTheme:n,setTheme:i}=(0,lH.useThemeStore)();return e?(0,w.jsx)("div",{className:"modal-overlay",onClick:t,children:(0,w.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,w.jsx)("h2",{children:"Choose Theme"}),(0,w.jsx)("div",{className:"theme-grid",children:Object.entries(lH.themes).map(([e,t])=>(0,w.jsxs)("button",{onClick:()=>{i(e)},className:`theme-option ${n===e?"theme-selected":""}`,style:{background:t.boardBg,color:t.text,border:`3px solid ${n===e?t.buttonBg:t.cellBorder}`},children:[(0,w.jsxs)("div",{className:"theme-preview",children:[(0,w.jsx)("div",{className:"theme-preview-cell",style:{background:t.cellBg,border:`1px solid ${t.cellBorderThin}`}}),(0,w.jsx)("div",{className:"theme-preview-cell",style:{background:t.cellFixed,border:`1px solid ${t.cellBorderThin}`}}),(0,w.jsx)("div",{className:"theme-preview-cell",style:{background:t.cellSelected,border:`1px solid ${t.cellBorderThin}`}})]}),(0,w.jsx)("span",{className:"theme-name",children:t.name})]},e))}),(0,w.jsx)("button",{onClick:t,className:"close-button",children:"Close"})]})}):null}function lB(){let{gameStarted:e,gameCompleted:t,timer:n,resetGame:i,solvedManually:r}=E(),[s,o]=(0,C.useState)(null),[a,l]=(0,C.useState)(""),[h,c]=(0,C.useState)(!0),[u,d]=(0,C.useState)(!1),[p,f]=(0,C.useState)(!1),[m,_]=(0,C.useState)(!1),[g,y]=(0,C.useState)(!1),[v,b]=(0,C.useState)(!1);(0,C.useEffect)(()=>{var e;let t=(e=e=>{o(e),e&&c(!1)},lp.onAuthStateChanged(e));return()=>t()},[]),(0,C.useEffect)(()=>{t&&s&&r&&T()},[t,s,r]);let I=async()=>{if(a.trim())try{let e=await lm(a);await lv(e.uid)||await ly(e.uid,a),o(e),c(!1)}catch(e){console.error("Login failed:",e)}},T=async()=>{if(s)try{await lb(s.uid),await lC(s.uid,n)&&await lT(s.uid,s.displayName,n)}catch(e){console.error("Failed to save game result:",e)}},k=()=>{i()};return h?(0,w.jsx)("main",{className:"login-screen",children:(0,w.jsxs)("div",{className:"login-container",children:[(0,w.jsx)("h1",{children:"Sudoku Solver"}),(0,w.jsx)("p",{children:"Enter your username to play"}),(0,w.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),onKeyPress:e=>"Enter"===e.key&&I(),placeholder:"Username",maxLength:50}),(0,w.jsx)("button",{onClick:I,children:"Start Playing"})]})}):e?(0,w.jsxs)("main",{className:"game-screen",children:[(0,w.jsxs)("div",{className:"game-header",children:[(0,w.jsx)("h1",{children:"Sudoku"}),(0,w.jsxs)("div",{className:"header-actions",children:[(0,w.jsx)("button",{onClick:k,children:"New Game"}),(0,w.jsx)("button",{onClick:()=>y(!0),children:"Profile"}),(0,w.jsx)("button",{onClick:()=>_(!0),children:"Leaderboard"}),(0,w.jsx)("button",{onClick:()=>b(!0),children:"Themes"}),(0,w.jsx)("button",{onClick:()=>d(!0),children:"Settings"})]})]}),(0,w.jsx)(lA,{}),(0,w.jsx)("div",{className:"game-container",children:(0,w.jsx)(lP,{})}),(0,w.jsx)(lR,{}),(0,w.jsx)(lx,{}),t&&r&&(0,w.jsx)("div",{className:"completion-modal",children:(0,w.jsxs)("div",{className:"completion-content",children:[(0,w.jsx)("h2",{children:"Puzzle Solved!"}),(0,w.jsxs)("p",{children:["Time: ",Math.floor(n/60),":",(n%60).toString().padStart(2,"0")]}),(0,w.jsx)("button",{onClick:k,children:"New Game"})]})}),(0,w.jsx)(lO,{isOpen:u,onClose:()=>d(!1)}),(0,w.jsx)(lq,{isOpen:m,onClose:()=>_(!1)}),(0,w.jsx)(lW,{isOpen:g,onClose:()=>y(!1)}),(0,w.jsx)(lV,{isOpen:v,onClose:()=>b(!1)})]}):(0,w.jsxs)("main",{className:"menu-screen",children:[(0,w.jsx)(lS,{onStart:()=>{}}),(0,w.jsxs)("div",{className:"menu-actions",children:[(0,w.jsx)("button",{onClick:()=>y(!0),children:"Profile"}),(0,w.jsx)("button",{onClick:()=>_(!0),children:"Leaderboard"}),(0,w.jsxs)("button",{onClick:()=>f(!p),children:[p?"Hide":"Show"," Multiplayer"]}),(0,w.jsx)("button",{onClick:()=>b(!0),children:"Themes"}),(0,w.jsx)("button",{onClick:()=>d(!0),children:"Settings"})]}),p&&(0,w.jsx)(lU,{onRoomJoined:(e,t)=>{}}),(0,w.jsx)(lO,{isOpen:u,onClose:()=>d(!1)}),(0,w.jsx)(lq,{isOpen:m,onClose:()=>_(!1)}),(0,w.jsx)(lW,{isOpen:g,onClose:()=>y(!1)}),(0,w.jsx)(lV,{isOpen:v,onClose:()=>b(!1)})]})}e.s(["default",()=>lB],81694)}]);